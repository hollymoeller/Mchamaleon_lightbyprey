---
title: "Mesodinium chamaeleon data analysis, revision 1"
author: "Holly Moeller"
date: "October 23, 2020"
output: 
  pdf_document:
    keep_tex: yes
  #html_document:
    #df_print: paged
---
## Loading of packages and data
```{r setup}
# LOAD RELEVANT PACKAGES
require(Rmisc) #has summarySE function, which is quite useful
require(sciplot) #has bargraph.CI function
require(pracma)


# IMPORT DATA
#setwd("/Users/hollyvm/GoogleSync/KarmaChamaeleon/JPhyc_R1/RAnalysis") # set working directory
dat<-read.csv('Meso_TS.csv',header=TRUE) # Timeseries of M. chamaeleon data
crypto.dat <- read.csv('Crypto_TS.csv',header=TRUE) # Timeseries of cryptophyte data
growth<-read.csv('GrowthRates.csv',header=TRUE) # Growthrates file
pe <- read.csv('MC_PEcurveData.csv',header=TRUE) # M. chamaeleon photosynthesis-irradiance data
pe.crypto <- read.csv('Crypto_PEcurvedata.csv',header=TRUE) # Cryptophyte photosynthesis-irradiance data
carbon <- read.csv('CHN.csv',header=TRUE) # CHN data

# Adjust necessary data into numeric form; create ID columns
#str(dat)
dat$ID <- paste(dat$Prey,dat$Light,dat$Fed,dat$Rep,sep='.')
dat$Pmax_chl <- dat$Pmax*0.06332817 # The multiplier 0.06332817 converts from electrons per chlorophyll molecule per second into pg C per pg chlorophyll-a per hour
dat$Pmax_cell <- dat$Pmax_chl*as.numeric(as.character(dat$corr_chl_p_cell)) 
dat$PI_chl <- dat$ETR_I*0.06332817
dat$PI_cell <- dat$PI_chl*as.numeric(as.character(dat$corr_chl_p_cell))
dat$chl_p_cell <- as.numeric(as.character(dat$corr_chl_p_cell)) # Sometimes R incorrectly imports data as character strings instead of numbers. These commands convert.
dat$chl_p_mL <- dat$chl_p_cell*dat$MC_cellspmL/1000
dat$PlastidCount <- as.numeric(as.character(dat$PlastidCount))

#str(crypto.dat)
crypto.dat$ID <- paste(crypto.dat$Prey,crypto.dat$Light,crypto.dat$Rep,sep='.')
crypto.dat$Pmax_chl <- crypto.dat$Pmax*0.06332817
crypto.dat$Pmax_cell <- crypto.dat$Pmax_chl*crypto.dat$ChlpCell
crypto.dat$PI_chl <- crypto.dat$P_I*0.06332817
crypto.dat$PI_cell <- crypto.dat$PI_chl*crypto.dat$ChlpCell

pe$ETR.C <- pe$ETR*0.06332817 # The multiplier 0.06332817 converts from electrons per chlorophyll molecule per second into pg C per chlorophyll molecule per hour


# SET PLOTTING PARAMETERS (COLOURS)
Acol <- 'red' # colour to plot rep A data
Bcol <- 'blue' # colour to plot rep B data
Ccol <- 'green' # colour to plot rep C data
Fedcol <- 'black'
Starvedcol <- 'gray80'
Cryptocol <- 'gray50'

SMcol <- 'firebrick'
RScol <- 'lightcoral'
CMcol <- 'seagreen'
HPcol <- 'turquoise3'
preycolvec <- c(CMcol,HPcol,RScol,SMcol)

days <- unique(dat$ExptDay)
```



## Computations

### Revision 1: Supplemental Figure: C per cell
```{r SuppFig.R1.Cpercell,fig.height=5,fig.width=3}
head(carbon)
par(mar=c(4,4,1,1),mfrow=c(2,1))
bargraph.CI(Prey,ngC_cell,data=carbon[carbon$Species=='MC',],las=1,xlab='Prey Type',ylab='MC C content (ng C cell-1)',col=preycolvec,ylim=c(0,1.15)); text(c(.7,1.9,3.1,4.3),c(1.11,.74,.81,.86),c('a','b','b','b'))
# TukeyHSD(aov(ngC_cell~Prey,data=carbon[carbon$Species=='MC',]))

bargraph.CI(Species,ngC_cell*1000,data=carbon[carbon$Species!='MC',],las=1,xlab='Cryptophyte',ylab='Prey C content (pg C cell-1)',col=preycolvec,ylim=c(0,.09)*1000); text(c(.7,1.9,3.1,4.3),c(.047,.0465,.067,.087)*1000,c('a','a','b','c'))
#TukeyHSD(aov(ngC_cell~Species,data=carbon[carbon$Species!='MC',]))

```

### Revision 1: Incorporating C per cell
```{r revision.Cpercell}
# M. chamaeleon
MC.C <- summarySE(data=carbon[carbon$Species=='MC',],measurevar='ngC_cell',groupvar='Prey')
dat$Cpercell <- MC.C$ngC_cell[match(dat$Prey,MC.C$Prey)]
dat$ChlperC <- dat$chl_p_cell/dat$Cpercell
dat$Pmax_C <- dat$Pmax_cell/dat$Cpercell
dat$PI_C <- dat$PI_cell/dat$Cpercell

# Cryptophytes
prey.C <- summarySE(data=carbon[carbon$Species!='MC',],measurevar='ngC_cell',groupvar='Species')
crypto.dat$Cpercell <- prey.C$ngC_cell[match(crypto.dat$Prey,prey.C$Species)]
crypto.dat$ChlperC <- crypto.dat$ChlpCell/crypto.dat$Cpercell
crypto.dat$Pmax_C <- crypto.dat$Pmax_cell/crypto.dat$Cpercell
crypto.dat$PI_C <- crypto.dat$PI_cell/crypto.dat$Cpercell
```


### Computing maxima
```{r ComputeMaxima}

# Pick max crypto response

crypto.max <- as.data.frame(unique(crypto.dat$ID))
colnames(crypto.max) <- c('ID')
crypto.max$Prey <- crypto.dat$Prey[match(crypto.max$ID,crypto.dat$ID)]
crypto.max$Light <- crypto.dat$Light[match(crypto.max$ID,crypto.dat$ID)]
crypto.max$Rep <- crypto.dat$Rep[match(crypto.max$ID,crypto.dat$ID)]
crypto.max$chl <- NaN; crypto.max$FvFm <- NaN; crypto.max$P_I <- NaN; crypto.max$a <- NaN; crypto.max$Pmax <- NaN; crypto.max$Pmax_chl <- NaN; crypto.max$Pmax_cell <- NaN; crypto.max$PI_chl <- NaN; crypto.max$PI_cell <- NaN
# Revision 1:
crypto.max$PI_C <- NaN; crypto.max$Pmax_C <- NaN; crypto.max$ChlperC <- NaN

for(i in 1:length(unique(crypto.dat$ID))){
	hold <- crypto.dat[crypto.dat$ID==unique(crypto.dat$ID)[i],]
	crypto.max$chl[i] <- max(hold$ChlpCell,na.rm=TRUE)
	hold2 <- hold
	if(hold$Prey[1]=='CM'){	hold2 <- hold[hold$ExptDay%in%c(0,1),]}
	crypto.max$FvFm[i] <- max(hold2$Fv.Fm,na.rm=TRUE)
	hold <- hold[hold$ExptDay%in%c(0,1,2,4),]
	crypto.max$P_I[i] <- max(hold$P_I,na.rm=TRUE)
	crypto.max$Pmax[i] <- max(hold$Pmax,na.rm=TRUE)
	crypto.max$a[i] <- max(hold$a,na.rm=TRUE)
	crypto.max$Pmax_chl[i] <- max(hold$Pmax_chl,na.rm=TRUE)
	crypto.max$Pmax_cell[i] <- max(hold$Pmax_cell,na.rm=TRUE)
	crypto.max$PI_chl[i] <- max(hold$PI_chl,na.rm=TRUE)
	crypto.max$PI_cell[i] <- max(hold$PI_cell,na.rm=TRUE)
	# Revision 1:
	crypto.max$PI_C[i] <- max(hold$PI_C,na.rm=TRUE)
	crypto.max$Pmax_C[i] <- max(hold$Pmax_C,na.rm=TRUE)
	crypto.max$ChlperC[i] <- max(hold$ChlperC,na.rm=TRUE)
}

MC.max <- as.data.frame(unique(dat$ID))
colnames(MC.max) <- c('ID')
MC.max$Prey <- dat$Prey[match(MC.max$ID,dat$ID)]
MC.max$Light <- dat$Light[match(MC.max$ID,dat$ID)]
MC.max$Fed <- dat$Fed[match(MC.max$ID,dat$ID)]
MC.max$Rep <- dat$Rep[match(MC.max$ID,dat$ID)]
MC.max$chl <- NaN; MC.max$FvFm <- NaN; MC.max$P_I <- NaN; MC.max$a <- NaN; MC.max$Pmax <- NaN; MC.max$Pmax_chl <- NaN; MC.max$Pmax_cell <- NaN; MC.max$PI_chl <- NaN; MC.max$PI_cell <- NaN; 
MC.max$plastids <- NaN

# Revision 1:
MC.max$ChlperC <- NaN; MC.max$Pmax_C <- NaN; MC.max$PI_C <- NaN

for(i in 1:length(unique(dat$ID))){
	hold <- dat[dat$ID==unique(dat$ID)[i],]
	hold <- hold[hold$ExptDay%in%c(0,1,2,4,6),]
	MC.max$P_I[i] <- max(hold$ETR_I,na.rm=TRUE)
	MC.max$a[i] <- max(hold$a,na.rm=TRUE)
	MC.max$Pmax[i] <- max(hold$Pmax,na.rm=TRUE)	
	MC.max$Pmax_chl[i] <- max(hold$Pmax_chl,na.rm=TRUE)
	MC.max$Pmax_cell[i] <- max(hold$Pmax_cell,na.rm=TRUE)
	MC.max$PI_chl[i] <- max(hold$PI_chl,na.rm=TRUE)
	MC.max$PI_cell[i] <- max(hold$PI_cell,na.rm=TRUE)
	hold <- hold[hold$ExptDay%in%c(0,1,2,4),]
	MC.max$chl[i] <- max(hold$chl_p_cell,na.rm=TRUE)
	MC.max$FvFm[i] <- max(hold$FvFm,na.rm=TRUE)
	MC.max$plastids[i] <- max(hold$PlastidCount,na.rm=TRUE)
	
	# Revision 1:
	MC.max$ChlperC[i] <- max(hold$ChlperC,na.rm=TRUE)
	MC.max$Pmax_C[i] <- max(hold$Pmax_C,na.rm=TRUE)
	MC.max$PI_C[i] <- max(hold$PI_C,na.rm=TRUE)
}

crypto.max$Prey.Light <- paste(crypto.max$Prey,crypto.max$Light,sep='.')
MC.max$Prey.Light <- paste(MC.max$Prey,MC.max$Light,sep='.')
MC.max$Treat.Rep <- paste('1802',MC.max$ID,sep='.')

MC.max$relFvFm <- NaN
MC.max$relP_I <- NaN
MC.max$rela <- NaN
MC.max$relPmax <- NaN
MC.max$relPmax_chl <- NaN
MC.max$relPI_chl <- NaN

# Revision 1:
MC.max$relPI_C <- NaN
MC.max$relPmax_C <- NaN


for(i in 1:dim(MC.max)[1]){
	# Compute relative MC FvFm
	callID <- MC.max$Prey.Light[i]
	MC.max$relFvFm[i] <- MC.max$FvFm[i]/mean(crypto.max[crypto.max$Prey.Light==callID,]$FvFm,na.rm=TRUE)
	
	# Compute relative MC P_I
	MC.max$relP_I[i] <- MC.max$P_I[i]/mean(crypto.max[crypto.max$Prey.Light==callID,]$P_I,na.rm=TRUE)
	
	# Compute relative MC a
	MC.max$rela[i] <- MC.max$a[i]/mean(crypto.max[crypto.max$Prey.Light==callID,]$a,na.rm=TRUE)
	
	# Compute relative MC P_max
	MC.max$relPmax[i] <- MC.max$Pmax[i]/mean(crypto.max[crypto.max$Prey.Light==callID,]$Pmax,na.rm=TRUE)
	
	# Compute relative MC P_max per chl
	MC.max$relPmax_chl[i] <- MC.max$Pmax_chl[i]/mean(crypto.max[crypto.max$Prey.Light==callID,]$Pmax_chl,na.rm=TRUE)
	
	# Compute relative MC P_I per chl
	MC.max$relPI_chl[i] <- MC.max$PI_chl[i]/mean(crypto.max[crypto.max$Prey.Light==callID,]$PI_chl,na.rm=TRUE)	
	
	# Revision 1:
	# Compute relative MC P_I per C
	MC.max$relPI_C[i] <- MC.max$PI_C[i]/mean(crypto.max[crypto.max$Prey.Light==callID,]$PI_C,na.rm=TRUE)
	# Compute relative MC P_max per C
	MC.max$relPmax_C[i] <- MC.max$Pmax_C[i]/mean(crypto.max[crypto.max$Prey.Light==callID,]$Pmax_C,na.rm=TRUE)
	
	}


```


```{r RateCalculations}

dat$Treat.Rep <- paste(dat$MCstrain,dat$Prey,dat$Light,dat$Fed,dat$Rep,sep='.')
#treat.data <- as.data.frame(unique(dat$Treatment))
growth$Treat.Rep <- paste(growth$MCstrain,growth$Prey,growth$Light,growth$Fed,growth$Rep,sep='.')

growth$ic <- NaN
growth$preyic <- NaN
growth$max <- NaN
growth$relincrease <- NaN
growth$relincreaseperprey <- NaN
for(i in 1:dim(growth)[1]){
	dat.hold <- dat[dat$Treat.Rep==growth$Treat.Rep[i],]
	growth$ic[i] <- dat.hold[dat.hold$ExptDay==0,]$MC_cellspmL
	growth$preyic[i] <- dat.hold[dat.hold$ExptDay==0,]$Prey_cellspmL
	growth$max[i] <- max(dat.hold$MC_cellspmL,na.rm=TRUE)
	growth$relincrease[i] <- growth$max[i]/growth$ic[i]
	growth$relincreaseperprey[i] <- (growth$max[i]-growth$ic[i])/growth$preyic[i]

}


growth$deltarelincreasefed <- NaN
for(i in 1:dim(growth[growth$Fed=='Y',])[1]){
  growth[growth$Fed=='Y',]$deltarelincreasefed[i] <- growth[growth$Fed=='Y',]$relincrease[i]-growth[growth$Fed=='N'&growth$Prey==growth[growth$Fed=='Y',]$Prey[i]&growth$Light==growth[growth$Fed=='Y',]$Light[i]&growth$Rep==growth[growth$Fed=='Y',]$Rep[i],]$relincrease
}




growth$TotPreyCons <- rep(0,dim(growth)[1])
times <- c(0,1,2,4,6,8,10,12,14)

for(i in 1:length(unique(dat$Treat.Rep))){
	callID <- unique(dat$Treat.Rep)[i]  # Select the dataset of interest
	if(growth[growth$Treat.Rep==callID,]$Fed=='Y'){ # If this is a fed dataset
		hold <- dat[dat$Treat.Rep==callID,]
		hold <- hold[!is.na(hold$MC_cellspmL),]
		prey <- hold$Prey_cellspmL
		MC <- hold$MC_cellspmL
		MC_init <- MC[1]
		graz <- growth[growth$Treat.Rep==callID,]$g
		fcn <- graz*prey
		for(j in 1:length(hold)[1]){if(is.nan(fcn[j])){fcn[j]<-0}}
		growth[growth$Treat.Rep==callID,]$TotPreyCons <- trapz(hold$ExptDay,fcn)
		growth[growth$Treat.Rep==callID,]$MC_init <- MC_init
	}
}

growth$PreyperMC <- growth$TotPreyCons/growth$ic


# photosynthesis contributions

growth$chl.loss.rate <- NaN
growth$plastid.loss.rate <- NaN
growth$FvFm.decline <- NaN
growth$chl.decline <- NaN
growth$FvFm.pctdecline <- NaN
growth$chl.pctdecline <- NaN
growth$PI.perchl <- NaN
growth$Cfixforchl <- NaN
growth$chl.res.time <- NaN
growth$C.perchl <- NaN
growth$C.perprey <- NaN
growth$C.fromprey <- NaN
growth$C.fixed <- NaN
growth$C.fixed2 <- NaN

# Revision 1:
growth$Pmax.change <- NaN
growth$a.change <- NaN
growth$Pmax.pctchange <- NaN
growth$a.pctchange <- NaN

IDs <- unique(growth$Treat.Rep)
times <- c(0,1,2,4,6,8,10,12,14)
tsteps <- 5 # number of timesteps to use 

for(i in 1:length(IDs)){
	# Choose the dataset
	callID <- IDs[i]
	hold <- dat[dat$Treat.Rep==callID,]
	
	# Determine rate of chlorophyll loss over first week
	chls <- log(hold$chl_p_cell)
	lm1 <- lm(chls[1:tsteps]~times[1:tsteps])
	if(hold$Prey[1]=="CM"){ 	lm1 <- lm(chls[2:tsteps]~times[2:tsteps])
	if(hold$Light[1]==10&hold$Rep[1]=='B'){ lm1 <- lm(chls[1:4]~times[1:4])		}}
	
	growth[growth$Treat.Rep==callID,]$chl.loss.rate <- summary(lm1)$coefficients[2,1]
	
	# Determine rate of plastid loss over first 48 hrs
	plastids <- log(hold$PlastidCount)
	lm2 <- lm(plastids[1:3]~times[1:3])
	growth[growth$Treat.Rep==callID,]$plastid.loss.rate <- summary(lm2)$coefficients[2,1]
	
	# Determine overall decline in Fv/Fm
	FvFm.init <- hold$FvFm[1]
	FvFm.min <- min(hold$FvFm,na.rm=TRUE)
	growth[growth$Treat.Rep==callID,]$FvFm.decline <- FvFm.init-FvFm.min
	growth[growth$Treat.Rep==callID,]$FvFm.pctdecline <- (FvFm.init-FvFm.min)/FvFm.init	
	
	# Determine overall change in alpha
	a.init <- hold$a[1]
	a.end <- hold$a[dim(hold)[1]]
	if(hold$Prey[1]=="CM"){if(hold$Light[1]==100){a.end <- hold$a[dim(hold)[1]-1]}} # Using Day 12 data because day 14 data missing
	growth[growth$Treat.Rep==callID,]$a.change <- a.init-a.end
	growth[growth$Treat.Rep==callID,]$a.pctchange <- (a.init-a.end)/a.init
	
	# Determine overall change in Pmax
	p.init <- hold$Pmax[1]
	p.end <- hold$Pmax[dim(hold)[1]]
	if(hold$Prey[1]=="CM"){if(hold$Light[1]==100){p.end <- hold$Pmax[dim(hold)[1]-1]}} # Using Day 12 data because day 14 data missing
	growth[growth$Treat.Rep==callID,]$Pmax.change <- p.init-p.end
	growth[growth$Treat.Rep==callID,]$Pmax.pctchange <- (p.init-p.end)/p.init
	
	# Determine overall decline in chl-a
	chla.init <- hold$chl_p_cell[1]
	chla.min <- min(hold$chl_p_cell,na.rm=TRUE)
	growth[growth$Treat.Rep==callID,]$chl.decline <- chla.init-chla.min
	growth[growth$Treat.Rep==callID,]$chl.pctdecline <- (chla.init-chla.min)/chla.init	
	
	# Chlorophyll residence time
	growth[growth$Treat.Rep==callID,]$chl.res.time = -1/(growth[growth$Treat.Rep==callID,]$chl.loss.rate)
	
	# Carbon fixed during that residence time
	PIs <- hold$PI_chl
	PI.mean <- mean(PIs[1:tsteps],na.rm=TRUE)
	growth[growth$Treat.Rep==callID,]$PI.perchl <- PI.mean
	growth[growth$Treat.Rep==callID,]$C.perchl <- PI.mean*growth[growth$Treat.Rep==callID,]$chl.res.time*12 #multiplying by 12 because PI is C per chl per hr, and there are 12hrs of light
	
	# Carbon fixed per prey cell
	preychl <- mean(crypto.max[crypto.max$Prey==hold$Prey[1]&crypto.max$Light==hold$Light[1],]$chl,na.rm=TRUE)
	growth[growth$Treat.Rep==callID,]$C.perprey <- preychl*growth[growth$Treat.Rep==callID,]$C.perchl
	
	# Carbon fixed from all prey across the experiment
	preycons <- mean(growth[growth$Fed=='Y'&growth$Prey==hold$Prey[1]&growth$Light==hold$Light[1],]$PreyperMC,na.rm=TRUE)
	growth[growth$Treat.Rep==callID,]$C.fromprey <- preycons*growth[growth$Treat.Rep==callID,]$C.perprey
	
	# Carbon fixed, calculated as integral of chl-a/cell * PI_chl
	hold <- hold[!is.na(hold$PI_cell),]
	growth[growth$Treat.Rep==callID,]$C.fixed <- trapz(hold$ExptDay,hold$chl_p_cell*hold$PI_chl*12) # multiply by 12 because 12hrs daylight/day
	
	# Carbon fixed, calculated as integral of chl-a/mL * PI_chl divided by initial cells
	hold <- hold[!is.na(hold$chl_p_mL),]
	growth[growth$Treat.Rep==callID,]$C.fixed2 <- trapz(hold$ExptDay,hold$PI_chl*12*hold$chl_p_mL)/hold[hold$ExptDay==0,]$MC_cellspmL*1000 # multiply by 12 because 12hrs daylight/day
	
}

growth$deltaCfixed <- NaN
for(i in 1:dim(growth[growth$Fed=='Y',])[1]){
  growth[growth$Fed=='Y',]$deltaCfixed[i] <- growth[growth$Fed=='Y',]$C.fixed2[i]-growth[growth$Fed=='N'&growth$Prey==growth[growth$Fed=='Y',]$Prey[i]&growth$Light==growth[growth$Fed=='Y',]$Light[i]&growth$Rep==growth[growth$Fed=='Y',]$Rep[i],]$C.fixed2
}

```


## Visualizing Data

```{r plottingaesthetics, echo=FALSE}

# First, create a colour vector

alpha10 <- 1		# transparencies for each light level
alpha50 <- .50
alpha100 <- .1
CM10.rgb <- rgb(39/255,123/255,69/255,alpha10)  # used digital colour meter to determine RGB values for colours chosen above
CM50.rgb <- rgb(39/255,123/255,69/255,alpha50)
CM100.rgb <- rgb(39/255,123/255,69/255,alpha100)
HP10.rgb <- rgb(24/255,186/255,194/255,alpha10)
HP50.rgb <- rgb(24/255,186/255,194/255,alpha50)
HP100.rgb <- rgb(24/255,186/255,194/255,alpha100)
RS10.rgb <- rgb(234/255,105/255,109/255,alpha10)
RS50.rgb <- rgb(234/255,105/255,109/255,alpha50)
RS100.rgb <- rgb(234/255,105/255,109/255,alpha100)
SM10.rgb <- rgb(160/255,17/255,27/255,alpha10)
SM50.rgb <- rgb(160/255,17/255,27/255,alpha50)
SM100.rgb <- rgb(160/255,17/255,27/255,alpha100)

prey.light.colvec <- c(CM10.rgb,CM50.rgb,CM100.rgb,HP10.rgb,HP50.rgb,HP100.rgb,RS10.rgb,RS50.rgb,RS100.rgb,SM10.rgb,SM50.rgb,SM100.rgb)
```

### Figure 1: Loss of photosynthetic capacity in starved cultures
```{r PhotosynthLoss, fig.height=6.7, fig.width=4.5}

par(mar=c(2,4,0.5,0.5),mfrow=c(4,1))
xcoords <- c(1,2,3,4.5,5.5,6.5,8,9,10,11.5,12.5,13.5)

# FvFm at day 14
bargraph.CI(Prey,FvFm,group=Light,data=dat[dat$Fed=='N'&dat$ExptDay==14,],legend=FALSE,err.width=0.05,las=3,names=rep('',4),ylim=c(0,0.32),col=prey.light.colvec,space=c(0,0.5),las=1,ylab='FvFm, Day 14'); abline(h=0,lwd=1.5); text(xcoords,c(.24,.2,.19,.25,.205,.2,.235,.31,.225,.295,.284,.283),c('ab','ac','c','a','ac','ac','a','d','ac','bd','bd','bd')) 
#TukeyHSD(aov(FvFm~Prey*as.factor(Light),data=dat[dat$Fed=='N'&dat$ExptDay==14,]))

# decline in FvFm
#bargraph.CI(Prey,FvFm.decline,group=Light,data=growth[growth$Fed=='N',],legend=FALSE,err.width=0.05,las=3,names=rep('',4),ylim=c(0,0.4),col=prey.light.colvec,space=c(0,0.5),ylab='FvFm decline'); abline(h=0,lwd=1.5)
bargraph.CI(Prey,100*FvFm.pctdecline,group=Light,data=growth[growth$Fed=='N',],legend=FALSE,err.width=0.05,las=3,names=rep('',4),ylim=c(0,82),col=prey.light.colvec,space=c(0,0.5),ylab='Pct FvFm decline',las=1); abline(h=0,lwd=1.5); text(xcoords,c(55,50,80,61,69,68,54,38,57,41,40,42),c('ab','ab','c','ac','bc','bc','ac','a','ab','a','a','ab')) 
#TukeyHSD(aov(FvFm.pctdecline~Prey*as.factor(Light),data=growth[growth$Fed=='N',]))

# pigment decay rate
bargraph.CI(Prey,-1*(chl.loss.rate),group=Light,data=growth[growth$Fed=='N',],legend=FALSE,err.width=0.05,las=3,ylim=c(0,0.3),names=rep('',4),col=prey.light.colvec,space=c(0,0.5),ylab='Chl-a loss rate (per day)',las=1); abline(h=0,lwd=1.5); text(xcoords,c(.03,.1,.09,.075,.1,.14,.15,.17,.275,.145,.16,.15),c('a','abc','ab','ab','abc','bc','bc','c','d','bc','c','bc'))
#TukeyHSD(aov(-1*(chl.loss.rate)~Prey*as.factor(Light),data=growth[growth$Fed=='N',]))

# P(I) at day 14
bargraph.CI(Prey,PI_cell,group=Light,data=dat[dat$Fed=='N'&dat$ExptDay==14,],legend=FALSE,err.width=0.05,las=3,ylim=c(0,50),col=prey.light.colvec,space=c(0,0.5),las=1,ylab='P(I)/cell, Day 14'); abline(h=0,lwd=1.5); text(xcoords,c(5,15,28,10,26,44,8,22,34,7,12,40),c('a','ab','abc','ab','bd','cd','ab','abe','de','a','ab','cd')) ; 
#TukeyHSD(aov(PI_cell~Prey*as.factor(Light),data=dat[dat$Fed=='N'&dat$ExptDay==14,]))

# Even after 14 days of starvation, M. chamaeleon acclimated to all four types showed sustained photosynthetic capacity. Photosynthetic efficiency measurements indicated that 15-25% of photosystems were still competent for electron transfer (panel A), though these efficiencies represented declines of up to 75% from the onset of starvation (panel B). Pigment content declined over time, with rates of pigment loss generally higher at higher light levels (except for SM, panel C), yet sufficient pigment remained to support photosynthetic fixation of carbon (panel D). Data are all from starved cultures. 

```

### Figure 1, revision 1: Loss of photosynthetic capacity in starved cultures
```{r PhotosynthLoss.r1, fig.height=6., fig.width=7.5}

par(mar=c(2,4,0.3,0.5),mfrow=c(3,2))
xcoords <- c(1,2,3,4.5,5.5,6.5,8,9,10,11.5,12.5,13.5)

# FvFm at day 14
bargraph.CI(Prey,FvFm,group=Light,data=dat[dat$Fed=='N'&dat$ExptDay==14,],legend=FALSE,err.width=0.05,las=3,names=rep('',4),ylim=c(0,0.32),col=prey.light.colvec,space=c(0,0.5),las=1,ylab='FvFm, Day 14'); abline(h=0,lwd=1.5); text(xcoords,c(.24,.2,.19,.25,.205,.2,.235,.31,.225,.295,.284,.283),c('ab','ac','c','a','ac','ac','a','d','ac','bd','bd','bd')) 
#TukeyHSD(aov(FvFm~Prey*as.factor(Light),data=dat[dat$Fed=='N'&dat$ExptDay==14,]))

# P(I) at day 14
bargraph.CI(Prey,PI_chl,group=Light,data=dat[dat$Fed=='N'&dat$ExptDay==14,],legend=FALSE,err.width=0.05,las=3,ylim=c(0,12),names=rep('',4),col=prey.light.colvec,space=c(0,0.5),las=1,ylab='P(I)/chl, Day 14'); abline(h=0,lwd=1.5); text(xcoords,c(1,3.5,11,1,3.6,7.3,1.2,3.8,6.9,1,3.6,6.8),c('a','ab','c','a','ab','c','a','ac','bc','a','ab','c')) ; 
#TukeyHSD(aov(PI_chl~as.factor(Light)*Prey,data=dat[dat$Fed=='N'&dat$ExptDay==14,]))


# decline in FvFm
#bargraph.CI(Prey,FvFm.decline,group=Light,data=growth[growth$Fed=='N',],legend=FALSE,err.width=0.05,las=3,names=rep('',4),ylim=c(0,0.4),col=prey.light.colvec,space=c(0,0.5),ylab='FvFm decline'); abline(h=0,lwd=1.5)
bargraph.CI(Prey,100*FvFm.pctdecline,group=Light,data=growth[growth$Fed=='N',],legend=FALSE,err.width=0.05,las=3,names=rep('',4),ylim=c(0,82),col=prey.light.colvec,space=c(0,0.5),ylab='Pct FvFm decline',las=1); abline(h=0,lwd=1.5); text(xcoords,c(55,50,80,61,69,68,54,38,57,41,40,42),c('ab','ab','c','ac','bc','bc','ac','a','ab','a','a','ab')) 
#TukeyHSD(aov(FvFm.pctdecline~Prey*as.factor(Light),data=growth[growth$Fed=='N',]))

# pigment decay rate
bargraph.CI(Prey,-1*(chl.loss.rate),group=Light,data=growth[growth$Fed=='N',],legend=FALSE,err.width=0.05,las=3,ylim=c(0,0.3),names=rep('',4),col=prey.light.colvec,space=c(0,0.5),ylab='Chl-a loss rate (per day)',las=1); abline(h=0,lwd=1.5); text(xcoords,c(.03,.1,.09,.075,.1,.14,.15,.17,.275,.145,.16,.15),c('a','abc','ab','ab','abc','bc','bc','c','d','bc','c','bc'))
#TukeyHSD(aov(-1*(chl.loss.rate)~Prey*as.factor(Light),data=growth[growth$Fed=='N',]))


# Revision 1:
# pct change in alpha
# bargraph.CI(Prey,-100*a.pctchange,group=Light,data=growth[growth$Fed=='N',],legend=FALSE,err.width=0.05,las=3,names=rep('',4),ylim=c(-70,100),col=prey.light.colvec,space=c(0,0.5),ylab='Pct alpha change',las=1);abline(h=0,lwd=1.5)

# pct change in Pmax
# bargraph.CI(Prey,-100*Pmax.pctchange,group=Light,data=growth[growth$Fed=='N',],legend=FALSE,err.width=0.05,las=3,names=rep('',4),ylim=c(-70,550),col=prey.light.colvec,space=c(0,0.5),ylab='Pct Pmax change',las=1);abline(h=0,lwd=1.5)

# change in alpha
bargraph.CI(Prey,-a.change,group=Light,data=growth[growth$Fed=='N',],legend=FALSE,err.width=0.05,las=3,ylim=c(-.8,.75),col=prey.light.colvec,space=c(0,0.5),ylab='Absolute alpha change',las=1);abline(h=0,lwd=1.5); text(xcoords,c(.25,.25,.35,0.08,0.08,.15,0.08,.23,.68,0.08,0.08,.33),c('abc','abc','ac',   'd','ad','acd',   'ade','abc','c',   'bd','ade','ce'))
#TukeyHSD(aov(a.change~as.factor(Light)*Prey,data=growth[growth$Fed=='N',]))

# change in Pmax
bargraph.CI(Prey,-Pmax.change,group=Light,data=growth[growth$Fed=='N',],legend=FALSE,err.width=0.05,las=3,ylim=c(-70,150),col=prey.light.colvec,space=c(0,0.5),ylab='Absolute Pmax change',las=1);abline(h=0,lwd=1.5); text(xcoords,c(60,60,60,88,98,140,8,8,68,8,8,8),c('ab','ab','ab',   'bcd','cd','d',   'e','ae','abc',   'ae','ae','abe'))
#TukeyHSD(aov(Pmax.change~as.factor(Light)*Prey,data=growth[growth$Fed=='N',]))
```


### Supplementary Figure: PE curves over time, by prey and light level, measured in electron transport per chlorophyll-a
```{r Figure.PEcurves.ETR,fig.height=6,fig.width=9}

# Note: this is in electron transport rate (electrons per s per chl-a)
# To convert to C, multiply by *0.06332817


pe.summ <- summarySE(data=pe,'ETR',groupvars=c('Prey','Light','Fed','ExptDay','PAR'),na.rm=TRUE)



preychoice_set <- c('CM','HP','RS','SM')
lightchoice_set <- c(10,50,100)
ymax_set <- c(100,130,200)

days <- unique(pe.summ$ExptDay)
bgvec <- rev(c('gray90','gray80','gray70','gray60','gray50','gray40','gray30','gray20','black'))

par(mar=c(1,1,0.5,0.5))
layout(matrix(c(rep(c(13,1,1,1,2,2,2,3,3,3,4,4,4),3),rep(c(13,5,5,5,6,6,6,7,7,7,8,8,8),3),rep(c(13,9,9,9,10,10,10,11,11,11,12,12,12),3),rep(14,3*5+1)),nrow=3*3+1,ncol=4*3+1,byrow=TRUE))



for(lightctr in 1:length(lightchoice_set)){
    lightchoice <- lightchoice_set[lightctr]
    ymaxchoice <- ymax_set[lightctr]

for(preyctr in 1:length(preychoice_set)){
  preychoice = preychoice_set[preyctr]


hold <- pe.summ[pe.summ$Prey==preychoice&pe.summ$Light==lightchoice&pe.summ$Fed=='N',]


plot(hold$PAR,hold$ETR,bg=bgvec[as.factor(hold$ExptDay)],pch=21,cex=1.5,xlab='',ylab='',las=1,ylim=c(0,ymaxchoice),xaxt='n',yaxt='n',type='n'); if(lightctr==3){axis(side=1,labels=T)}else{axis(side=1,labels=F)}; if(preyctr==1){axis(side=2,labels=T,las=1)}else{ axis(sid=2,labels=F)}
Iset <- seq(from = 0, to = 200,length.out=1000)
for(i in 1:length(days)){
  Pmax <- mean(dat[dat$Prey==preychoice&dat$Light==lightchoice&dat$Fed=='N'&dat$ExptDay==days[i],]$Pmax)
  alpha <- mean(dat[dat$Prey==preychoice&dat$Light==lightchoice&dat$Fed=='N'&dat$ExptDay==days[i],]$a)
  # Curves were fit with the Jassby & Platt hyperbolic tangent function: 
  # ETR  =  P * tanh(a * PAR / P)
  
  ETRset <- Pmax*tanh(alpha*Iset/Pmax)
  lines(Iset,ETRset,col=bgvec[i],lwd=3)
}
if(lightctr==3){mtext('PAR (umol quanta m-2 s-1)',side=1,line=2.5,cex=0.8)}
if(preyctr==1){mtext('ETR (e- s-1 chl-a-1)',side=2,line=3,cex=0.8)}
if(lightctr==1){
  if(preyctr==1){mtext(substitute(paste(italic('C. mesostigmatica'))),side=3,line=-1.75,cex=.8)}
  if(preyctr==2){mtext(substitute(paste(italic('H. pacifica'))),side=3,line=-1.75,cex=.8)}
  if(preyctr==3){mtext(substitute(paste(italic('R. salina'))),side=3,line=-1.5,cex=.8)}
  if(preyctr==4){mtext(substitute(paste(italic('S. major'))),side=3,line=-1.75,cex=.8)}
  
}
  }}

```

### Supplementary Figure: PE curves over time, by prey and light level, measured in carbon fixation per cell
```{r Figure.PEcurves.ETRcell,fig.height=6,fig.width=9}

dat$Treat.Rep.Day <- paste(dat$Treat.Rep,dat$ExptDay,sep='.')
pe$Treat.Rep.Day <- paste(pe$MCstrain,pe$Prey,pe$Light,pe$Fed,pe$Rep,pe$ExptDay,sep='.')
pe$chl <- dat$corr_chl_p_cell[match(pe$Treat.Rep.Day,dat$Treat.Rep.Day)]
pe$ETR.cell <- pe$ETR.C*as.numeric(as.character(pe$chl))


pe.summ <- summarySE(data=pe,'ETR.cell',groupvars=c('Prey','Light','Fed','ExptDay','PAR'),na.rm=TRUE)



preychoice_set <- c('CM','HP','RS','SM')
lightchoice_set <- c(10,50,100)
ymax_set <- c(160,160,160)

days <- unique(pe.summ$ExptDay)
bgvec <- rev(c('gray90','gray80','gray70','gray60','gray50','gray40','gray30','gray20','black'))

par(mar=c(1,1,0.5,0.5))
layout(matrix(c(rep(c(13,1,1,1,2,2,2,3,3,3,4,4,4),3),rep(c(13,5,5,5,6,6,6,7,7,7,8,8,8),3),rep(c(13,9,9,9,10,10,10,11,11,11,12,12,12),3),rep(14,3*5+1)),nrow=3*3+1,ncol=4*3+1,byrow=TRUE))



for(lightctr in 1:length(lightchoice_set)){
    lightchoice <- lightchoice_set[lightctr]
    ymaxchoice <- ymax_set[lightctr]

for(preyctr in 1:length(preychoice_set)){
  preychoice = preychoice_set[preyctr]


hold <- pe.summ[pe.summ$Prey==preychoice&pe.summ$Light==lightchoice&pe.summ$Fed=='N',]


plot(hold$PAR,hold$ETR.cell,bg=bgvec[as.factor(hold$ExptDay)],pch=21,cex=1.5,xlab='',ylab='',las=1,ylim=c(0,ymaxchoice),xaxt='n',yaxt='n',type='n'); if(lightctr==3){axis(side=1,labels=T)}else{axis(side=1,labels=F)}; if(preyctr==1){axis(side=2,labels=T,las=1)}else{ axis(sid=2,labels=F)}
Iset <- seq(from = 0, to = 200,length.out=1000)
for(i in 1:length(days)){
  Pmax <- mean(dat[dat$Prey==preychoice&dat$Light==lightchoice&dat$Fed=='N'&dat$ExptDay==days[i],]$Pmax_cell)
  alpha <- mean(dat[dat$Prey==preychoice&dat$Light==lightchoice&dat$Fed=='N'&dat$ExptDay==days[i],]$a)*0.06332817*mean(as.numeric(as.character(dat[dat$Prey==preychoice&dat$Light==lightchoice&dat$Fed=='N'&dat$ExptDay==days[i],]$corr_chl_p_cell)))
  # Curves were fit with the Jassby & Platt hyperbolic tangent function: 
  # ETR  =  P * tanh(a * PAR / P)
  
  ETRset <- Pmax*tanh(alpha*Iset/Pmax)
  lines(Iset,ETRset,col=bgvec[i],lwd=3)
}
if(lightctr==3){mtext('PAR (umol quanta m-2 s-1)',side=1,line=2.5,cex=0.8)}
if(preyctr==1){mtext('C fix (pg C cell-1 hr-1)',side=2,line=3,cex=0.8)}
if(lightctr==1){
  if(preyctr==1){mtext(substitute(paste(italic('C. mesostigmatica'))),side=3,line=-1.75,cex=.8)}
  if(preyctr==2){mtext(substitute(paste(italic('H. pacifica'))),side=3,line=-1.75,cex=.8)}
  if(preyctr==3){mtext(substitute(paste(italic('R. salina'))),side=3,line=-1.75,cex=.8)}
  if(preyctr==4){mtext(substitute(paste(italic('S. major'))),side=3,line=-1.75,cex=.8)}
  
}
  }}

```

### Supplementary Figure, Revision: PE curves over time, by prey and light level, measured in carbon fixation per C
```{r Figure.PEcurves.ETR.C,fig.height=6,fig.width=9}

dat$Treat.Rep.Day <- paste(dat$Treat.Rep,dat$ExptDay,sep='.')
pe$Treat.Rep.Day <- paste(pe$MCstrain,pe$Prey,pe$Light,pe$Fed,pe$Rep,pe$ExptDay,sep='.')
pe$chl <- dat$corr_chl_p_cell[match(pe$Treat.Rep.Day,dat$Treat.Rep.Day)]
pe$ETR.cell <- pe$ETR.C*as.numeric(as.character(pe$chl))


pe.summ <- summarySE(data=pe,'ETR.cell',groupvars=c('Prey','Light','Fed','ExptDay','PAR'),na.rm=TRUE)



preychoice_set <- c('CM','HP','RS','SM')
lightchoice_set <- c(10,50,100)
ymax_set <- c(250,250,250)

days <- unique(pe.summ$ExptDay)
bgvec <- rev(c('gray90','gray80','gray70','gray60','gray50','gray40','gray30','gray20','black'))

par(mar=c(1,1,0.5,0.5))
layout(matrix(c(rep(c(13,1,1,1,2,2,2,3,3,3,4,4,4),3),rep(c(13,5,5,5,6,6,6,7,7,7,8,8,8),3),rep(c(13,9,9,9,10,10,10,11,11,11,12,12,12),3),rep(14,3*5+1)),nrow=3*3+1,ncol=4*3+1,byrow=TRUE))



for(lightctr in 1:length(lightchoice_set)){
    lightchoice <- lightchoice_set[lightctr]
    ymaxchoice <- ymax_set[lightctr]

for(preyctr in 1:length(preychoice_set)){
  preychoice = preychoice_set[preyctr]
  preyC <- mean(carbon[carbon$Prey==preychoice_set[preyctr],]$ngC_cell)



hold <- pe.summ[pe.summ$Prey==preychoice&pe.summ$Light==lightchoice&pe.summ$Fed=='N',]


plot(hold$PAR,hold$ETR.cell/preyC,bg=bgvec[as.factor(hold$ExptDay)],pch=21,cex=1.5,xlab='',ylab='',las=1,ylim=c(0,ymaxchoice),xaxt='n',yaxt='n',type='n')
if(lightctr==3){axis(side=1,labels=T)}else{axis(side=1,labels=F)}; if(preyctr==1){axis(side=2,labels=T,las=1)}else{ axis(sid=2,labels=F)}
Iset <- seq(from = 0, to = 200,length.out=1000)
for(i in 1:length(days)){
  Pmax <- mean(dat[dat$Prey==preychoice&dat$Light==lightchoice&dat$Fed=='N'&dat$ExptDay==days[i],]$Pmax_C)
  alpha <- mean(dat[dat$Prey==preychoice&dat$Light==lightchoice&dat$Fed=='N'&dat$ExptDay==days[i],]$a)*0.06332817*mean(as.numeric(as.character(dat[dat$Prey==preychoice&dat$Light==lightchoice&dat$Fed=='N'&dat$ExptDay==days[i],]$corr_chl_p_cell)))/preyC
  # Curves were fit with the Jassby & Platt hyperbolic tangent function: 
  # ETR  =  P * tanh(a * PAR / P)
  
  ETRset <- Pmax*tanh(alpha*Iset/Pmax)
  lines(Iset,ETRset,col=bgvec[i],lwd=3)
}
if(lightctr==3){mtext('PAR (umol quanta m-2 s-1)',side=1,line=2.5,cex=0.8)}
if(preyctr==1){mtext('C fix (pg C cell-1 hr-1)',side=2,line=3,cex=0.8)}
if(lightctr==1){
  if(preyctr==1){mtext(substitute(paste(italic('C. mesostigmatica'))),side=3,line=-1.75,cex=.8)}
  if(preyctr==2){mtext(substitute(paste(italic('H. pacifica'))),side=3,line=-1.75,cex=.8)}
  if(preyctr==3){mtext(substitute(paste(italic('R. salina'))),side=3,line=-1.5,cex=.8)}
  if(preyctr==4){mtext(substitute(paste(italic('S. major'))),side=3,line=-1.75,cex=.8)}
  
}
  }}

```

### Figure 2: Maximum photosynthetic performance
```{r Figure.MaxPhotPerformance,fig.height=6.65,fig.width=4}


#quartz(height=6.65,width=4)
xcoords <- c(1,2,3,4.5,5.5,6.5,8,9,10,11.5,12.5,13.5)
layout(matrix(c(1,1,2,2,3,3,4,4,5)))
par(mar=c(.5,4,0.5,2))

# Panel A: Fv/Fm
bargraph.CI(Prey,FvFm,group=as.factor(Light),data=MC.max[MC.max$Fed=='Y',],ylim=c(0.35,0.6),las=1,space=c(0,0.5),err.width=0.08,ylab='Photosynth. Eff. (Fv/Fm)',names=rep('',4)); abline(h=0.35,lwd=1.5); summ.FvFm <- summarySE(data=crypto.max,measurevar='FvFm',groupvars=c('Prey','Light')); lines(xcoords[1:3],summ.FvFm[1:3,4],col=CMcol); lines(xcoords[4:6],summ.FvFm[4:6,4],col=HPcol); lines(xcoords[7:9],summ.FvFm[7:9,4],col=RScol); lines(xcoords[10:12],summ.FvFm[10:12,4],col=SMcol);  arrows(xcoords,summ.FvFm[,4]-summ.FvFm$se,xcoords,summ.FvFm[,4]+summ.FvFm$se,col=c(CMcol,HPcol,RScol,SMcol)[summ.FvFm$Prey],code=3,angle=90,length=0.05); points(xcoords,summ.FvFm[,4],pch=22,col=c(CMcol,HPcol,RScol,SMcol)[summ.FvFm$Prey],bg=c(CMcol,HPcol,RScol,SMcol)[summ.FvFm$Prey],cex=1.2); legend(x = 12.5, y = .6, legend=c('10','50','100'), pch=22,pt.cex=2.5,pt.bg=c('gray30','gray60','gray90'),horiz=FALSE); text(xcoords,c(.44,.47,.47,.54,.53,.51,.48,.44,.47,.48,.42,.42),c('a','bc','bc','d','d','bd','b','ab','b','b','ac','ac'))

#TukeyHSD(aov(FvFm~as.factor(Light)*Prey,data=MC.max[MC.max$Fed=='Y',]))

# Panel B: P_max per chl
bargraph.CI(Prey,Pmax_chl,group=as.factor(Light),data=MC.max[MC.max$Fed=='Y',],ylim=c(0,15),las=1,space=c(0,0.5),err.width=0.08,ylab='P_max (pg C / pg chl-a / hr)',names=rep('',4)); abline(h=0,lwd=1.5); summ.Pmax <- summarySE(data=crypto.max,measurevar='Pmax_chl',groupvars=c('Prey','Light')); lines(xcoords[1:3],summ.Pmax[1:3,4],col=CMcol); lines(xcoords[4:6],summ.Pmax[4:6,4],col=HPcol); lines(xcoords[7:9],summ.Pmax[7:9,4],col=RScol); lines(xcoords[10:12],summ.Pmax[10:12,4],col=SMcol);  arrows(xcoords,summ.Pmax[,4]-summ.Pmax$se,xcoords,summ.Pmax[,4]+summ.Pmax$se,col=c(CMcol,HPcol,RScol,SMcol)[summ.Pmax$Prey],code=3,angle=90,length=0.05); points(xcoords,summ.Pmax[,4],pch=22,col=c(CMcol,HPcol,RScol,SMcol)[summ.Pmax$Prey],bg=c(CMcol,HPcol,RScol,SMcol)[summ.Pmax$Prey],cex=1.2); text(xcoords,c(7,9,10,5,3.5,4,7.5,8,8,8.5,8.5,9.5),c('a','bc','c','d','d','d','abc','abc','abc','ab','abc','c'))

#TukeyHSD(aov(Pmax_chl~Prey*as.factor(Light),data=MC.max[MC.max$Fed=='Y',]))

# Panel C: alpha
bargraph.CI(Prey,a,group=as.factor(Light),data=MC.max[MC.max$Fed=='Y',],ylim=c(0,2.5),las=1,space=c(0,0.5),err.width=0.08,ylab='alpha',names=rep('',4)); abline(h=0,lwd=1.5); summ.Pmax <- summarySE(data=crypto.max,measurevar='a',groupvars=c('Prey','Light')); lines(xcoords[1:3],summ.Pmax[1:3,4],col=CMcol); lines(xcoords[4:6],summ.Pmax[4:6,4],col=HPcol); lines(xcoords[7:9],summ.Pmax[7:9,4],col=RScol); lines(xcoords[10:12],summ.Pmax[10:12,4],col=SMcol);  arrows(xcoords,summ.Pmax[,4]-summ.Pmax$se,xcoords,summ.Pmax[,4]+summ.Pmax$se,col=c(CMcol,HPcol,RScol,SMcol)[summ.Pmax$Prey],code=3,angle=90,length=0.05); points(xcoords,summ.Pmax[,4],pch=22,col=c(CMcol,HPcol,RScol,SMcol)[summ.Pmax$Prey],bg=c(CMcol,HPcol,RScol,SMcol)[summ.Pmax$Prey],cex=1.2); text(xcoords,c(1.2,1.6,1.3,1.4,2.4,2.25,1.7,1.8,1.9,1.4,2.1,1.8),c('a','ab','ab','ab','c','c','b','b','b','ab','b','b'))

#TukeyHSD(aov(a~Prey*as.factor(Light),data=MC.max[MC.max$Fed=='Y',]))

# Panel D: P(I) per chl
bargraph.CI(Prey,PI_chl,group=as.factor(Light),data=MC.max[MC.max$Fed=='Y',],las=1,ylim=c(0,9),space=c(0,0.5),err.width=0.08,ylab='P(I) (pg C / chl-a / hr)'); abline(h=0,lwd=1.5); summ.P_I <- summarySE(data=crypto.max,measurevar='PI_chl',groupvars=c('Prey','Light')); lines(xcoords[1:3],summ.P_I[1:3,4],col=CMcol); lines(xcoords[4:6],summ.P_I[4:6,4],col=HPcol); lines(xcoords[7:9],summ.P_I[7:9,4],col=RScol); lines(xcoords[10:12],summ.P_I[10:12,4],col=SMcol);  arrows(xcoords,summ.P_I[,4]-summ.P_I$se,xcoords,summ.P_I[,4]+summ.P_I$se,col=c(CMcol,HPcol,RScol,SMcol)[summ.P_I$Prey],code=3,angle=90,length=0.05); points(xcoords,summ.P_I[,4],pch=22,col=c(CMcol,HPcol,RScol,SMcol)[summ.P_I$Prey],bg=c(CMcol,HPcol,RScol,SMcol)[summ.P_I$Prey],cex=1.2); mtext('Prey Type',side=1,line=1.8,cex=.7); text(xcoords,c(1.5,5,5.8,2,2.3,3.2,1.6,3.9,5.8,1.8,3.8,6.6),c('a','b','c','a','d','e','a','be','c','a','be','f'))

#TukeyHSD(aov(PI_chl~Prey*as.factor(Light),data=MC.max[MC.max$Fed=='Y',]))

```




### Supplementary Figure: Relative photosynthetic capacity (compared to prey)
```{r Figure.RelativeRates,fig.width=6.28,fig.height=5.44}

preytypes <- c('CM','HP','RS','SM'); ptcex <- 1.5
#quartz(width=6.28,height=5.44)
par(mar=c(4,4,0.2,1),mfrow=c(2,2))

plot(MC.max[MC.max$Fed=='Y',]$Light,MC.max[MC.max$Fed=='Y',]$relFvFm,pch=21,bg= preycolvec[MC.max[MC.max$Fed=='Y',]$Prey],type='n',xlab='',xlim=c(0,100),ylab='Relative Photosynth. Eff. (Fv/Fm)',las=1); summdat <- summarySE(data=MC.max[MC.max$Fed=='Y',],measurevar='relFvFm',groupvars=c('Light','Prey')); for(i in 1:length(preytypes)){lines(summdat[summdat$Prey==preytypes[i],]$Light,summdat[summdat$Prey==preytypes[i],4],col=preycolvec[i])}; arrows(summdat$Light,summdat[,4]+summdat$se,summdat$Light,summdat[,4]-summdat$se,col=preycolvec[summdat$Prey],code=3,angle=90,length=0.05); points(summdat$Light,summdat[,4],pch=22,cex= ptcex,bg=preycolvec[summdat$Prey]); legend(80,0.84,c('CM','HP','RS','SM'),cex=.9,pch=22,pt.bg=preycolvec,pt.cex= ptcex)

plot(MC.max[MC.max$Fed=='Y',]$Light,MC.max[MC.max$Fed=='Y',]$rela,pch=21,bg= preycolvec[MC.max[MC.max$Fed=='Y',]$Prey],type='n',xlab='',xlim=c(0,100),ylab='Relative alpha',las=1); summdat <- summarySE(data=MC.max[MC.max$Fed=='Y',],measurevar='rela',groupvars=c('Light','Prey')); for(i in 1:length(preytypes)){lines(summdat[summdat$Prey==preytypes[i],]$Light,summdat[summdat$Prey==preytypes[i],4],col=preycolvec[i])}; arrows(summdat$Light,summdat[,4]+summdat$se,summdat$Light,summdat[,4]-summdat$se,col=preycolvec[summdat$Prey],code=3,angle=90,length=0.05); points(summdat$Light,summdat[,4],pch=22,cex= ptcex,bg=preycolvec[summdat$Prey])

plot(MC.max[MC.max$Fed=='Y',]$Light,MC.max[MC.max$Fed=='Y',]$relPmax_chl,pch=21,bg= preycolvec[MC.max[MC.max$Fed=='Y',]$Prey],type='n',xlab='Light Level',xlim=c(0,100),ylab='Relative P_max (pg C / chl-a * hr)',las=1); summdat <- summarySE(data=MC.max[MC.max$Fed=='Y',],measurevar='relPmax_chl',groupvars=c('Light','Prey')); for(i in 1:length(preytypes)){lines(summdat[summdat$Prey==preytypes[i],]$Light,summdat[summdat$Prey==preytypes[i],4],col=preycolvec[i])}; arrows(summdat$Light,summdat[,4]+summdat$se,summdat$Light,summdat[,4]-summdat$se,col=preycolvec[summdat$Prey],code=3,angle=90,length=0.05); points(summdat$Light,summdat[,4],pch=22,cex= ptcex,bg=preycolvec[summdat$Prey])

plot(MC.max[MC.max$Fed=='Y',]$Light,MC.max[MC.max$Fed=='Y',]$relPI_chl,pch=21,bg= preycolvec[MC.max[MC.max$Fed=='Y',]$Prey],type='n',xlab='Light Level',xlim=c(0,100),ylab='Relative P(I) (pg C / chl-a * hr)',las=1); summdat <- summarySE(data=MC.max[MC.max$Fed=='Y',],measurevar='relPI_chl',groupvars=c('Light','Prey')); for(i in 1:length(preytypes)){lines(summdat[summdat$Prey==preytypes[i],]$Light,summdat[summdat$Prey==preytypes[i],4],col=preycolvec[i])}; arrows(summdat$Light,summdat[,4]+summdat$se,summdat$Light,summdat[,4]-summdat$se,col=preycolvec[summdat$Prey],code=3,angle=90,length=0.05); points(summdat$Light,summdat[,4],pch=22,cex= ptcex,bg=preycolvec[summdat$Prey])


```


### Figure 3: Per-cell plastids, pigment, and C fixation
```{r Figure.PerCellPlastidsChlandCfix, fig.height=6.9, fig.width=4.65}
#quartz(height=4.6,width=4.65)
xcoords <- c(1,2,3,4.5,5.5,6.5,8,9,10,11.5,12.5,13.5)
par(mar=c(0.5,4,0.5,4))
layout(matrix(c(1,1,1,2,2,2,3,3,3,4)))

bargraph.CI(Prey,plastids,group=Light,data=MC.max[MC.max$Fed=='Y',],legend=FALSE,x.leg=1,y.leg=15,ylim=c(0,34),err.width=0.05,las=3,xlab='',names=rep('',4),ylab='Max plastids per MC',space=c(0,0.5),las=1); abline(h=0,lwd=1.5); text(x=xcoords,y=c(26,17,12.5,31.5,22.5,22.5,17,11,20,27,26,23),c('ab','ab','a', 'c','abc','abc', 'ab','a','abc', 'bc','abc','abc'),srt=0)
#TukeyHSD(aov(plastids~as.factor(Light)*Prey,data=MC.max[MC.max$Fed=='Y',]))




# chl-a per cell
bargraph.CI(Prey,chl,group=as.factor(Light),data=MC.max[MC.max$Fed=='Y',],las=1,ylim=c(0,60),space=c(0,0.5),err.width=0.08,ylab='Chlorophyll-a per M. chamaeleon cell',xlab='',names=rep('',4)); abline(h=0,lwd=1.5); summ.chl <- summarySE(data=crypto.max,measurevar='chl',groupvars=c('Prey','Light')); summ.chl[,4]<-summ.chl[,4]*10; summ.chl$se <- summ.chl$se*10; lines(xcoords[1:3],summ.chl[1:3,4],col=CMcol); lines(xcoords[4:6],summ.chl[4:6,4],col=HPcol); lines(xcoords[7:9],summ.chl[7:9,4],col=RScol); lines(xcoords[10:12],summ.chl[10:12,4],col=SMcol);  arrows(xcoords,summ.chl[,4]-summ.chl$se,xcoords,summ.chl[,4]+summ.chl$se,col=c(CMcol,HPcol,RScol,SMcol)[summ.chl$Prey],code=3,angle=90,length=0.05); points(xcoords,summ.chl[,4],pch=22,col=c(CMcol,HPcol,RScol,SMcol)[summ.chl$Prey],bg=c(CMcol,HPcol,RScol,SMcol)[summ.chl$Prey],cex=1.2); axis(side=4,las=1,at=c(0,10,20,30,40,50,60),labels=c(0:6));  mtext('Chlorophyll-a per prey cell',side=4,line=2,cex=0.7)
legend(x = 0.25, y = 55, legend=c('10','50','100'), pch=22,pt.cex=2.5,pt.bg=c('gray30','gray60','gray90'),horiz=TRUE);  text(xcoords,c(25,29,24,28.5,24,17,58,34,34,50,36,32),c('ab','ab','ab','ab','ab','b','c','a','ad','cd','ad','ab'))
#TukeyHSD(aov(chl~Prey*as.factor(Light),data=MC.max[MC.max$Fed=='Y',]))

# P(I) per cell
bargraph.CI(Prey,PI_cell,group=as.factor(Light),data=MC.max[MC.max$Fed=='Y',],las=1,ylim=c(0,170),space=c(0,0.5),err.width=0.08,ylab='P(I) (pg C / cell / hr)'); abline(h=0,lwd=1.5); summ.P_I <- summarySE(data=crypto.max,measurevar='PI_cell',groupvars=c('Prey','Light')); summ.P_I[,4]<- 5*summ.P_I[,4]; summ.P_I$se <- 5*summ.P_I$se; lines(xcoords[1:3],summ.P_I[1:3,4],col=CMcol); lines(xcoords[4:6],summ.P_I[4:6,4],col=HPcol); lines(xcoords[7:9],summ.P_I[7:9,4],col=RScol); lines(xcoords[10:12],summ.P_I[10:12,4],col=SMcol);  arrows(xcoords,summ.P_I[,4]-summ.P_I$se,xcoords,summ.P_I[,4]+summ.P_I$se,col=c(CMcol,HPcol,RScol,SMcol)[summ.P_I$Prey],code=3,angle=90,length=0.05); points(xcoords,summ.P_I[,4],pch=22,col=c(CMcol,HPcol,RScol,SMcol)[summ.P_I$Prey],bg=c(CMcol,HPcol,RScol,SMcol)[summ.P_I$Prey],cex=1.2); mtext('Prey Type',side=1,line=1.8,cex=.7); axis(side=4,las=1,at=c(0,50,100,150),labels=c(0,10,20,30)); 
mtext('Prey P(I) (pg C / crypto / hr) ',side=4,line=2,cex=0.7); text(xcoords,c(18,108,118,24,43,43,45,95,153,40,125,167),c('a','b','b','a','a','a','a','b','c','a','b','c'))

#TukeyHSD(aov(PI_cell~Prey*as.factor(Light),data=MC.max[MC.max$Fed=='Y',]))

```



### Figure 3, Revised: Per-cell plastids, pigment, and C fixation
```{r Figure.PerCellPlastidsChlandCfix.R1, fig.height=8.5, fig.width=4.65}
#quartz(height=4.6,width=4.65)
xcoords <- c(1,2,3,4.5,5.5,6.5,8,9,10,11.5,12.5,13.5)
par(mar=c(0.5,4,0.5,4))
layout(matrix(c(1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6)))

bargraph.CI(Prey,plastids,group=Light,data=MC.max[MC.max$Fed=='Y',],legend=FALSE,x.leg=1,y.leg=15,ylim=c(0,34),err.width=0.05,las=3,xlab='',names=rep('',4),ylab='Max plastids per MC',space=c(0,0.5),las=1); abline(h=0,lwd=1.5); text(x=xcoords,y=c(26,17,12.5,31.5,22.5,22.5,17,11,20,27,26,23),c('ab','ab','a', 'c','abc','abc', 'ab','a','abc', 'bc','abc','abc'),srt=0)
#TukeyHSD(aov(plastids~as.factor(Light)*Prey,data=MC.max[MC.max$Fed=='Y',]))




# chl-a per cell
bargraph.CI(Prey,chl,group=as.factor(Light),data=MC.max[MC.max$Fed=='Y',],las=1,ylim=c(0,60),space=c(0,0.5),err.width=0.08,ylab='Chlorophyll-a per M. chamaeleon cell',xlab='',names=rep('',4)); abline(h=0,lwd=1.5); summ.chl <- summarySE(data=crypto.max,measurevar='chl',groupvars=c('Prey','Light')); summ.chl[,4]<-summ.chl[,4]*10; summ.chl$se <- summ.chl$se*10; lines(xcoords[1:3],summ.chl[1:3,4],col=CMcol); lines(xcoords[4:6],summ.chl[4:6,4],col=HPcol); lines(xcoords[7:9],summ.chl[7:9,4],col=RScol); lines(xcoords[10:12],summ.chl[10:12,4],col=SMcol);  arrows(xcoords,summ.chl[,4]-summ.chl$se,xcoords,summ.chl[,4]+summ.chl$se,col=c(CMcol,HPcol,RScol,SMcol)[summ.chl$Prey],code=3,angle=90,length=0.05); points(xcoords,summ.chl[,4],pch=22,col=c(CMcol,HPcol,RScol,SMcol)[summ.chl$Prey],bg=c(CMcol,HPcol,RScol,SMcol)[summ.chl$Prey],cex=1.2); axis(side=4,las=1,at=c(0,10,20,30,40,50,60),labels=c(0:6));  mtext('Chlorophyll-a per prey cell',side=4,line=2,cex=0.7)
legend(x = 0.25, y = 55, legend=c('10','50','100'), pch=22,pt.cex=2.5,pt.bg=c('gray30','gray60','gray90'),horiz=TRUE);  text(xcoords,c(25,29,24,28.5,24,17,58,34,34,50,36,32),c('ab','ab','ab','ab','ab','b','c','a','ad','cd','ad','ab'))
#TukeyHSD(aov(chl~Prey*as.factor(Light),data=MC.max[MC.max$Fed=='Y',]))

# P(I) per cell
bargraph.CI(Prey,PI_cell,group=as.factor(Light),data=MC.max[MC.max$Fed=='Y',],las=1,ylim=c(0,170),space=c(0,0.5),err.width=0.08,ylab='P(I) (pg C / cell / hr)',names=rep('',4)); abline(h=0,lwd=1.5); summ.P_I <- summarySE(data=crypto.max,measurevar='PI_cell',groupvars=c('Prey','Light')); summ.P_I[,4]<- 5*summ.P_I[,4]; summ.P_I$se <- 5*summ.P_I$se; lines(xcoords[1:3],summ.P_I[1:3,4],col=CMcol); lines(xcoords[4:6],summ.P_I[4:6,4],col=HPcol); lines(xcoords[7:9],summ.P_I[7:9,4],col=RScol); lines(xcoords[10:12],summ.P_I[10:12,4],col=SMcol);  arrows(xcoords,summ.P_I[,4]-summ.P_I$se,xcoords,summ.P_I[,4]+summ.P_I$se,col=c(CMcol,HPcol,RScol,SMcol)[summ.P_I$Prey],code=3,angle=90,length=0.05); points(xcoords,summ.P_I[,4],pch=22,col=c(CMcol,HPcol,RScol,SMcol)[summ.P_I$Prey],bg=c(CMcol,HPcol,RScol,SMcol)[summ.P_I$Prey],cex=1.2); axis(side=4,las=1,at=c(0,50,100,150),labels=c(0,10,20,30)); 
mtext('Prey P(I) (pg C / crypto / hr) ',side=4,line=2.2,cex=0.7); text(xcoords,c(18,108,118,24,43,43,45,95,153,40,125,167),c('a','b','b','a','a','a','a','b','c','a','b','c'))

#TukeyHSD(aov(PI_cell~Prey*as.factor(Light),data=MC.max[MC.max$Fed=='Y',]))

# chl per C
bargraph.CI(Prey,ChlperC,group=as.factor(Light),data=MC.max[MC.max$Fed=='Y',],las=1,ylim=c(0,90),space=c(0,0.5),err.width=0.08,ylab='Chlorophyll-a per C',xlab='',names=rep('',4)); abline(h=0,lwd=1.5); summ.chl <- summarySE(data=crypto.max,measurevar='ChlperC',groupvars=c('Prey','Light')); summ.chl[,4]<-summ.chl[,4]; summ.chl$se <- summ.chl$se; lines(xcoords[1:3],summ.chl[1:3,4],col=CMcol); lines(xcoords[4:6],summ.chl[4:6,4],col=HPcol); lines(xcoords[7:9],summ.chl[7:9,4],col=RScol); lines(xcoords[10:12],summ.chl[10:12,4],col=SMcol);  arrows(xcoords,summ.chl[,4]-summ.chl$se,xcoords,summ.chl[,4]+summ.chl$se,col=c(CMcol,HPcol,RScol,SMcol)[summ.chl$Prey],code=3,angle=90,length=0.05); points(xcoords,summ.chl[,4],pch=22,col=c(CMcol,HPcol,RScol,SMcol)[summ.chl$Prey],bg=c(CMcol,HPcol,RScol,SMcol)[summ.chl$Prey],cex=1.2); axis(side=4,las=1,at=c(0,20,40,60,80));  mtext('Chlorophyll-a per prey cell',side=4,line=2,cex=0.7)
text(xcoords,c(26,31,24,48,39,28,85,52,52,68,50,55),c('a','ab','a',     'bc','ab','a',    'd','bc','c',    'cd','bc','abc'))
#TukeyHSD(aov(ChlperC~as.factor(Light)*Prey,data=MC.max[MC.max$Fed=='Y',]))

# P(I) per C
bargraph.CI(Prey,PI_C,group=as.factor(Light),data=MC.max[MC.max$Fed=='Y',],las=1,ylim=c(0,250),space=c(0,0.5),err.width=0.08,ylab='P(I) (pg C / C / hr)'); abline(h=0,lwd=1.5); summ.P_I <- summarySE(data=crypto.max,measurevar='PI_C',groupvars=c('Prey','Light')); summ.P_I[,4]<- .5*summ.P_I[,4]; summ.P_I$se <- .5*summ.P_I$se; lines(xcoords[1:3],summ.P_I[1:3,4],col=CMcol); lines(xcoords[4:6],summ.P_I[4:6,4],col=HPcol); lines(xcoords[7:9],summ.P_I[7:9,4],col=RScol); lines(xcoords[10:12],summ.P_I[10:12,4],col=SMcol);  arrows(xcoords,summ.P_I[,4]-summ.P_I$se,xcoords,summ.P_I[,4]+summ.P_I$se,col=c(CMcol,HPcol,RScol,SMcol)[summ.P_I$Prey],code=3,angle=90,length=0.05); points(xcoords,summ.P_I[,4],pch=22,col=c(CMcol,HPcol,RScol,SMcol)[summ.P_I$Prey],bg=c(CMcol,HPcol,RScol,SMcol)[summ.P_I$Prey],cex=1.2); mtext('Prey Type',side=1,line=1.8,cex=.7); axis(side=4,las=1,at=c(0,50,100,150,200,250),labels=c(0,100,200,300,400,500)); 
mtext('Prey P(I) (pg C / crypto / hr) ',side=4,line=2.5,cex=0.7); text(xcoords,c(38,115,128,40,83,73,70,145,228,58,162,238),c('a','b','b','a','a','a','a','b','c','a','b','c'))

#TukeyHSD(aov(PI_cell~Prey*as.factor(Light),data=MC.max[MC.max$Fed=='Y',]))
```





### Figure 4: Growth rate and extent
```{r,Figure.GrowthRateandExtent.Horiz.v2, fig.height=3.5,fig.width=11.5}

growth.summ<-summarySE(data=growth,measurevar='muMC',groupvars=c('Prey','Light','Fed'))
growth$Prey.Light <- paste(growth$Prey,growth$Light,sep='.')
prey.growth.summ <- summarySE(data=growth[growth$Fed=='Y',],measurevar='muPreyCtrl',groupvars=c('Prey','Light'))

xcoords <- c(1.2,3.4,5.6)
xcoords2 <- c(.7,1.7,2.9,3.9,5.1,6.1)
#quartz(height=3.5,width=7.5)
par(mar=c(1,1,0.5,0.5))
layout(matrix(c(11,1,1,1,2,2,2,3,3,3,4,4,4,9,9,9,9,9,9,10,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,9,9,9),nrow=2,ncol=19,byrow=TRUE))

# Column 1: Growth Rate
ymax <- 1.2; ymin <- -0.1; bargraph.CI(Light,muMC,group=Fed,data=growth[growth$Prey=='CM',],las=1,legend=FALSE,leg.lab=c('Starved','Fed'),x.leg=1,y.leg=ymax,ylim=c(ymin,ymax),names=c('','',''),ylab='',space=c(0,.2),err.width=0.05); abline(h=0); mtext(substitute(paste(italic('Chroomonas mesostigmatica'))),side=3,line=-0.5,cex=.7); lines(xcoords,prey.growth.summ[prey.growth.summ$Prey=='CM',]$muPreyCtrl,col=CMcol); arrows(xcoords,prey.growth.summ[prey.growth.summ$Prey=='CM',]$muPreyCtrl-prey.growth.summ[prey.growth.summ$Prey=='CM',]$se,xcoords,prey.growth.summ[prey.growth.summ$Prey=='CM',]$muPreyCtrl+prey.growth.summ[prey.growth.summ$Prey=='CM',]$se,angle=90,code=3,length=0.05,col=CMcol); points(xcoords,prey.growth.summ[prey.growth.summ$Prey=='CM',]$muPreyCtrl,bg=CMcol,pch=22,col=CMcol,cex=1.2); mtext('Initial Growth Rate (per day)',side=2,line=2.5,cex=.7);text(x=xcoords2,y=c(0.2,0.16,0.17,0.48,0.05,0.53),c('a','a','a','b','c','b'))

bargraph.CI(Light,muMC,group=Fed,data=growth[growth$Prey=='HP',],las=1,legend=FALSE,leg.lab=c('Starved','Fed'),x.leg=1,y.leg=0.6,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05,ylab='',axes=FALSE); abline(h=0); mtext(substitute(paste(italic('Hemiselmis pacifica'))),side=3,line=-0.5,cex=.7); lines(xcoords,prey.growth.summ[prey.growth.summ$Prey=='HP',]$muPreyCtrl,col=HPcol); arrows(xcoords,prey.growth.summ[prey.growth.summ$Prey=='HP',]$muPreyCtrl-prey.growth.summ[prey.growth.summ$Prey=='HP',]$se,xcoords,prey.growth.summ[prey.growth.summ$Prey=='HP',]$muPreyCtrl+prey.growth.summ[prey.growth.summ$Prey=='HP',]$se,angle=90,code=3,length=0.05,col=HPcol); points(xcoords,prey.growth.summ[prey.growth.summ$Prey=='HP',]$muPreyCtrl,bg=HPcol,pch=22,col=HPcol,cex=1.2); axis(side=2,labels=FALSE);text(x=xcoords2,y=c(0.28,0.37,0.23,0.53,0.33,0.62),c('ab','ac','ab','cd','ab','d'))

bargraph.CI(Light,muMC,group=Fed,data=growth[growth$Prey=='RS',],las=1,legend=FALSE,leg.lab=c('Starved','Fed'),x.leg=1,y.leg=0.6,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05,ylab='',axes=FALSE); abline(h=0); mtext(substitute(paste(italic('Rhodomonas salina'))),side=3,line=-0.5,cex=.7); lines(xcoords,prey.growth.summ[prey.growth.summ$Prey=='RS',]$muPreyCtrl,col=RScol); arrows(xcoords,prey.growth.summ[prey.growth.summ$Prey=='RS',]$muPreyCtrl-prey.growth.summ[prey.growth.summ$Prey=='RS',]$se,xcoords,prey.growth.summ[prey.growth.summ$Prey=='RS',]$muPreyCtrl+prey.growth.summ[prey.growth.summ$Prey=='RS',]$se,angle=90,code=3,length=0.05,col=RScol); points(xcoords,prey.growth.summ[prey.growth.summ$Prey=='RS',]$muPreyCtrl,bg=RScol,pch=22,col=RScol,cex=1.2); axis(side=2,labels=FALSE);text(x=xcoords2,y=c(0.32,0.46,0.28,0.58,0.33,0.6),c('a','b','a','b','a','b'))

bargraph.CI(Light,muMC,group=Fed,data=growth[growth$Prey=='SM',],las=1,legend=FALSE,leg.lab=c('Starved','Fed'),x.leg=1,y.leg=0.6,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05,ylab='',axes=FALSE); abline(h=0); mtext(substitute(paste(italic('Storeatula major'))),side=3,line=-0.5,cex=.7); lines(xcoords,prey.growth.summ[prey.growth.summ$Prey=='SM',]$muPreyCtrl,col=SMcol); arrows(xcoords,prey.growth.summ[prey.growth.summ$Prey=='SM',]$muPreyCtrl-prey.growth.summ[prey.growth.summ$Prey=='SM',]$se,xcoords,prey.growth.summ[prey.growth.summ$Prey=='SM',]$muPreyCtrl+prey.growth.summ[prey.growth.summ$Prey=='SM',]$se,angle=90,code=3,length=0.05,col=SMcol); points(xcoords,prey.growth.summ[prey.growth.summ$Prey=='SM',]$muPreyCtrl,bg=SMcol,pch=22,col=SMcol,cex=1.2); axis(side=2,labels=FALSE) ;text(x=xcoords2,y=c(0.35,0.39,0.27,0.54,0.25,0.53),c('a','ab','a','c','a','bc'))

# Row 2: growth extent
xlabelstr <- '10uE          50uE       100uE'
ymax <- 12.4; ymin <- 0; bargraph.CI(Light,relincrease,group=Fed,data=growth[growth$Prey=='CM',],las=1,legend=TRUE,leg.lab=c('Starved','Fed'),x.leg=0.2,y.leg=ymax,cex.leg=1.2,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05); abline(h=0); mtext(xlabelstr,side=1,line=-0,cex=.65); mtext('Growth Extent',side=2,line=2.5,cex=0.7); text(x=xcoords2,y=c(1.8,3,2.8,8.8,1.5,9.5),c('a','a','a','b','a','b'))

bargraph.CI(Light,relincrease,group=Fed,data=growth[growth$Prey=='HP',],las=1,legend=FALSE,leg.lab=c('Starved','Fed'),x.leg=1,y.leg=0.6,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05,ylab='',axes=FALSE); abline(h=0); mtext(xlabelstr,side=1,line=-0,cex=.65); axis(side=2,labels=FALSE);text(x=xcoords2,y=c(2.1,4,2,3,2.3,4.8),c('a','b','a','c','ac','b'))

bargraph.CI(Light, relincrease,group=Fed,data=growth[growth$Prey=='RS',],las=1,legend=FALSE,leg.lab=c('Starved','Fed'),x.leg=1,y.leg=0.6,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05,ylab='',axes=FALSE); abline(h=0); mtext(xlabelstr,side=1,line=-0,cex=.65); axis(side=2,labels=FALSE);text(x=xcoords2,y=c(2.3,6,3.3,9.4,6.5,12.2),c('a','ab','a','bc','ab','c'))

bargraph.CI(Light, relincrease,group=Fed,data=growth[growth$Prey=='SM',],las=1,legend=FALSE,leg.lab=c('Starved','Fed'),x.leg=1,y.leg=0.6,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05,ylab='',axes=FALSE); abline(h=0); mtext(xlabelstr,side=1,line=-0,cex=.65); axis(side=2,labels=FALSE);text(x=xcoords2,y=c(2.5,6.8,3.3,7.6,2.7,5.8),c('a','bc','a','b','a','c'))



par(mar=c(4,5,0.1,0.1))
ptcex <- 2

# First panel: growth rate vs. growth extent

lm.all <- lm(growth$relincrease~growth$muMC); summary(lm.all) #signif.; F-stat = 86.4, p-val = 7.616e-14, R2 = .546, y = 13.0391 * x + 0.1771
lm.RS <- lm(relincrease~muMC,data=growth[growth$Prey=='RS',]); summary(lm.RS) #signif.; F-stat = 39.13, p-val = 1.148e-5, R2 = 0.6916, y = 21.457 * x - 1.942
lm.SM <- lm(relincrease~muMC,data=growth[growth$Prey=='SM',]); summary(lm.SM) #signif.; F-stat = 36.33, p-val = 1.758e-5, R2 = 0.6752, y = 13.2977 * x - 0.1947
lm.CM <- lm(relincrease~muMC,data=growth[growth$Prey=='CM',]); summary(lm.CM) #signif.; F-stat = 138.7, p-val = 2.7e-9, R2 = 0.8901, y = 16.1727 * x + 0.9255
lm.HP <- lm(relincrease~muMC,data=growth[growth$Prey=='HP',]); summary(lm.HP) #signif.; F-stat = 45.33, p-val = 4.81e-6, R2 = 0.7228, y = 5.9977 * x + 0.5010


plot(growth$muMC,growth$relincrease,pch=c(21,22,24)[as.factor(growth$Light)],bg=c(CMcol,HPcol,RScol,SMcol)[growth$Prey],ylab='Growth Extent (fold increase)', xlab='Growth Rate (per day)',xlim=c(-0.1,0.6),ylim=c(1,12),cex=1.5,type='n',las=1); C.summ <- summarySE(data=growth,measurevar='muMC',groupvars=c('Fed','Light','Prey')); abline(lm.all,lwd=1.5); abline(lm.RS,col=RScol); abline(lm.SM, col = SMcol); abline(lm.CM, col= CMcol); abline(lm.HP,col= HPcol); I.summ <- summarySE(data=growth,measurevar='relincrease',groupvars=c('Fed','Light','Prey')); arrows(C.summ[,5],I.summ[,5]+I.summ$se,C.summ[,5],I.summ[,5]-I.summ$se,code=3,col=c('gray80','black')[C.summ$Fed],angle=90,length=0.05); arrows(C.summ[,5]+C.summ$se,I.summ[,5],C.summ[,5]-C.summ$se,I.summ[,5],code=3,col=c('gray80','black')[C.summ$Fed],angle=90,length=0.05); points(C.summ[,5],I.summ[,5],pch=c(21,22,24)[as.factor(C.summ$Light)],bg=preycolvec[C.summ$Prey],col=c('gray80','black')[C.summ$Fed],cex=ptcex); legend(40,12.2,legend=c('10uE','50uE','100uE','Starved','Fed'),pch=c(21,22,24,21,21),pt.cex=ptcex,pt.bg=c(rep('black',3),'gray80','black'),col=c(rep('black',3),'gray80','black'),bty='n'); legend(1050,12.2,legend=c('CM','HP','RS','SM'),pch=21,pt.cex=ptcex,pt.bg=preycolvec,bty='n'); arrows(c(50,50,1800,1800),c(12,7.8,7.8,12),c(50,1800,1800,50),c(7.8,7.8,12,12),length=0); legend(-.1,12.2,legend=c('10uE','50uE','100uE','Starved','Fed'),pch=c(21,22,24,21,21),pt.cex=ptcex,pt.bg=c(rep('black',3),'gray80','black'),col=c(rep('black',3),'gray80','black'),bty='n',cex=1.2); legend(0.1,12.2,legend=c('CM','HP','RS','SM'),pch=21,pt.cex=ptcex,pt.bg=preycolvec,bty='n',cex=1.2); arrows(c(-.1,-.1,.25,.25),c(12,8.5,8.5,12),c(-.1,.25,.25,-.1),c(8.5,8.5,12,12),length=0)

#legend(x = -0.15, y = 12, legend = c('0 uE','50 uE','100 uE','CM','HP',"RS","SM"),cex=ptcex,pt.cex=1.5,pch=c(21,22,24,21,21,21,21),bty='y',pt.bg=c('white','white','white',CMcol,HPcol,RScol,SMcol))

```

### Figure 5: Heterotrophic contributions to growth
```{r, IngestionFigure, fig.height=5,fig.width=7}

#layout(matrix(c(1,1,1,2,2,2,8,3,3,3,4,4,4,7,5,5,5,6,6,6,9),nrow=(6*3+3),ncol=1))
layout(matrix(c(1,1,1,2,2,3,3,3,4,4),nrow=2,ncol=5,byrow=TRUE))
xcoords <- c(1,2,3,4.5,5.5,6.5,8,9,10,11.5,12.5,13.5)



# ingestion rate
par(mar=c(2,4,0.5,0.5))
bargraph.CI(Prey,ingest_2,group=Light,data=growth[growth$Fed=='Y',],legend=FALSE,x.leg=1,y.leg=15,ylim=c(0,18),err.width=0.05,las=1,xlab='Prey Type',names=rep('',4),ylab='Ingestion Rate (prey per MC per day)',col=prey.light.colvec,space=c(0,0.5));  abline(h=0,lwd=1.5); text(x=xcoords,y=c(5.5,4,11,4.2,6.1,8.5,9,12.5,7.5,7,16.5,12.5),c('ab','a','cd','a','ab','bc','bc','de','ac','ac','e','de'),srt=0)

par(mar=c(4,4,1,0.5))

# SECOND PLOT: ingestion rate vs growth rate
lm.all <- lm(growth[growth$Fed=='Y',]$muMC~growth[growth$Fed=='Y',]$ingest_2); summary(lm.all) #signif.; F-stat = 11.46, p-val = 0.001805, R2 = 0.2302, y = 0.017805 * x + 0.266463
lm.RS <- lm(muMC~ingest_2,data=growth[growth$Prey=='RS'&growth$Fed=='Y',]); summary(lm.RS) #signif.; F-stat = 0.004791, p-val = 0.9468, R2 = -0.1421, y = 0.000672 * x + 0.459887
lm.SM <- lm(muMC~ingest_2,data=growth[growth$Prey=='SM'&growth$Fed=='Y',]); summary(lm.SM) #signif.; F-stat = 11.58, p-val = 0.0114, R2 = 0.5694, y = 0.020717 * x + 0.189548
lm.CM <- lm(muMC~ingest_2,data=growth[growth$Prey=='CM'&growth$Fed=='Y',]); summary(lm.CM) #signif.; F-stat = 1.545, p-val = 0.2538, R2 = 0.06382, y = 0.02215 * x + 0.18688
lm.HP <- lm(muMC~ingest_2,data=growth[growth$Prey=='HP'&growth$Fed=='Y',]); summary(lm.HP) #signif.; F-stat = 22.27, p-val = 0.002159, R2 = 0.7267, y = 0.05503 * x + 0.12162

plot(growth[growth$Fed=='Y',]$ingest_2,growth[growth$Fed=='Y',]$muMC,las=1,pch=c(21,22,24)[as.factor(growth$Light)],bg=c(CMcol,HPcol,RScol,SMcol)[growth[growth$Fed=='Y',]$Prey],ylab='Growth Rate (per day)', xlab='Ingestion Rate (prey per MC per day)',type='n'); abline(lm.all,lwd=1.5); abline(lm.SM,col=SMcol); abline(lm.HP,col=HPcol); 
C.summ <- summarySE(data=growth[growth$Fed=='Y',],measurevar='muMC',groupvars=c('Light','Prey')); I.summ <- summarySE(data=growth[growth$Fed=='Y',],measurevar='ingest_2',groupvars=c('Light','Prey')); arrows(I.summ[,4],C.summ[,4]+C.summ$se,I.summ[,4],C.summ[,4]-C.summ$se,code=3,angle=90,length=0.05,col='black'); arrows(I.summ[,4]+I.summ$se,C.summ[,4],I.summ[,4]-I.summ$se,C.summ[,4],code=3,angle=90,length=0.05); points(I.summ[,4],C.summ[,4],pch=c(21,22,24)[as.factor(C.summ$Light)],bg=preycolvec[C.summ$Prey],cex=1.5)

legend(13.1,0.29,legend=c('10uE','50uE','100uE'),pch=c(21,22,24),pt.cex=ptcex,pt.bg='black',col='black',bty='n',cex=1.2); legend(10,0.29,legend=c('CM','HP','RS','SM'),pch=21,pt.cex=ptcex,pt.bg=preycolvec,bty='n',cex=1.2); arrows(c(10,10,17,17),c(0.28,.08,.08,0.28),c(10,17,17,10),c(.08,.08,.28,.28),length=0)



# linear scale: prey per initial MC
par(mar=c(2,4,0.5,0.5))
bargraph.CI(Prey,(PreyperMC),group=Light,data=growth[growth$Fed=='Y',],legend=FALSE,err.width=0.05,names=c('CM','HP','RS','SM'),axes=TRUE,ylim=c(0,(380)),col=prey.light.colvec,space=c(0,0.5),las=1,ylab='Heterotrophy (ingested prey per initial cell)'); abline(h=0,lwd=1.5); legend(11.5,350,c('10 uE','50 uE','100 uE'),bty='y',pch=22,pt.cex=2,horiz=FALSE,pt.bg=c('gray30','gray65','gray90'),cex=1.2); text(x=xcoords,y=(c(50,160,370,50,55,50,50,60,53,50,72,65)-15),c('a','b','c',rep('a',9)),srt=0)


# FOURTH PLOT: total ingestion vs growth extent

par(mar=c(4,4,1,0.5))
growth.y <- growth[growth$Fed=='Y',]
lm.all <- lm(growth.y$relincrease~log(growth.y$PreyperMC)); summary(lm.all) #signif.; F-stat = 8.4, p-val = 0.006525, R2 = 0.1745, y = 1.4408 * x + .6685
lm.RS.f <- lm(relincrease~log(PreyperMC),data=growth.y[growth.y$Prey=='RS'&growth.y$Fed=='Y',]); summary(lm.RS.f) #non-signif
lm.SM.f <- lm(relincrease~log(PreyperMC),data=growth.y[growth.y$Prey=='SM'&growth.y$Fed=='Y',]); summary(lm.SM.f) #non-signif.
lm.CM.f <- lm(relincrease~log(PreyperMC),data=growth.y[growth.y$Prey=='CM'&growth.y$Fed=='Y',]); summary(lm.CM.f) #signif.; F-stat = 43.57, p-val = 0.0003041, R2 = 0.8418, y = 2.3742 * x -4.5418
lm.HP.f <- lm(relincrease~log(PreyperMC),data=growth.y[growth.y$Prey=='HP'&growth.y$Fed=='Y',]); summary(lm.HP.f) #signif.; F-stat = 6.39, p-val = 0.03936, R2 = 0.4025, y = -2.1434 * x + 9.4956

plot(log(as.numeric(as.character(growth.y$PreyperMC))),growth.y$relincrease,pch=c(21,22,24)[as.factor(growth.y$Light)],bg=c(CMcol,HPcol,RScol,SMcol)[growth.y$Prey],ylab='Growth Extent (fold increase)', xlab='Heterotrophy (ln(ingested prey per initial cell))',type='n',las=1,ylim=c(0,12)); growth.y$logprey <- log(growth.y$PreyperMC); C.summ <- summarySE(data=growth.y, measurevar='logprey',groupvars=c('Fed','Light','Prey')); I.summ <- summarySE(data=growth.y,measurevar='relincrease',groupvars=c('Fed','Light','Prey')) ;abline(lm.all,lwd=1.5); abline(lm.CM.f,col=CMcol); abline(lm.HP.f,col=HPcol) ; arrows(C.summ[,5],I.summ[,5]+I.summ$se,C.summ[,5],I.summ[,5]-I.summ$se,code=3,col=c('gray80','black')[C.summ$Fed],angle=90,length=0.05); arrows(C.summ[,5]+C.summ$se,I.summ[,5],C.summ[,5]-C.summ$se,I.summ[,5],code=3,col=c('gray80','black')[C.summ$Fed],angle=90,length=0.05); points(C.summ[,5],I.summ[,5],pch=c(21,22,24)[as.factor(C.summ$Light)],bg=preycolvec[C.summ$Prey],col=c('gray80','black')[C.summ$Fed],cex=1.5);



#legend(1050,12.2,legend=c('CM','HP','RS','SM'),pch=21,pt.cex=ptcex,pt.bg=preycolvec,bty='n'); arrows(c(50,50,1800,1800),c(12,7.8,7.8,12),c(50,1800,1800,50),c(7.8,7.8,12,12),length=0); 




```


### Figure 5, revision: Heterotrophic contributions to growth
```{r, IngestionFigurer1, fig.height=5,fig.width=7}

#layout(matrix(c(1,1,1,2,2,2,8,3,3,3,4,4,4,7,5,5,5,6,6,6,9),nrow=(6*3+3),ncol=1))
layout(matrix(c(1,1,1,2,2,3,3,3,4,4),nrow=2,ncol=5,byrow=TRUE))
xcoords <- c(1,2,3,4.5,5.5,6.5,8,9,10,11.5,12.5,13.5)



# ingestion rate
par(mar=c(2,4,0.5,0.5))
bargraph.CI(Prey,ingest_2,group=Light,data=growth[growth$Fed=='Y',],legend=FALSE,x.leg=1,y.leg=15,ylim=c(0,18),err.width=0.05,las=1,xlab='Prey Type',names=rep('',4),ylab='Ingestion Rate (prey per MC per day)',col=prey.light.colvec,space=c(0,0.5));  abline(h=0,lwd=1.5); text(x=xcoords,y=c(5.5,4,11,4.2,6.1,8.5,9,12.5,7.5,7,16.5,12.5),c('ab','a','cd','a','ab','bc','bc','de','ac','ac','e','de'),srt=0)

par(mar=c(4,4,1,0.5))

# SECOND PLOT: ingestion rate vs growth rate
# Revision: convert to per carbon
carbon$Prey.Rep <- paste(carbon$Prey,carbon$Rep,sep='.')
carbon$Sp.Rep <- paste(carbon$Species,carbon$Rep,sep='.')
growth$Prey.Rep <- paste(growth$Prey,growth$Rep,sep='.')
growth$MC.C <- carbon[carbon$Species=='MC',]$ngC_cell[match(growth$Prey.Rep,carbon[carbon$Species=='MC',]$Prey.Rep)]
growth$prey.C <- carbon[carbon$Species!='MC',]$ngC_cell[match(growth$Prey.Rep,carbon[carbon$Species!='MC',]$Sp.Rep)]

growth$preyCperMCperday <- growth$ingest_2*growth$prey.C/growth$MC.C
growth$heterotrophy.C <- growth$PreyperMC*growth$prey.C/growth$MC.C

lm.all <- lm(growth[growth$Fed=='Y',]$muMC~growth[growth$Fed=='Y',]$preyCperMCperday); summary(lm.all) #signif.; F-stat = 7.454, p-val = 0.009955, R2 = 0.1557, y = 0.11187 * x + 0.32865
lm.RS <- lm(muMC~preyCperMCperday,data=growth[growth$Prey=='RS'&growth$Fed=='Y',]); summary(lm.RS) #n.s.
lm.SM <- lm(muMC~preyCperMCperday,data=growth[growth$Prey=='SM'&growth$Fed=='Y',]); summary(lm.SM) #signif.; F-stat = 8.786, p-val = 0.02098, R2 = 0.4932, y = 0.16037 * x + 0.21793
lm.CM <- lm(muMC~preyCperMCperday,data=growth[growth$Prey=='CM'&growth$Fed=='Y',]); summary(lm.CM) #n.s.
lm.HP <- lm(muMC~preyCperMCperday,data=growth[growth$Prey=='HP'&growth$Fed=='Y',]); summary(lm.HP) #signif.; F-stat = 27.53, p-val = 0.00119, R2 = 0.7683, y = 0.88395 * x + 0.12936

plot(growth[growth$Fed=='Y',]$preyCperMCperday,growth[growth$Fed=='Y',]$muMC,las=1,pch=c(21,22,24)[as.factor(growth$Light)],bg=c(CMcol,HPcol,RScol,SMcol)[growth[growth$Fed=='Y',]$Prey],ylab='Growth Rate (per day)', xlab='Ingestion Rate (prey C per MC C per day)',type='n'); abline(lm.all,lwd=1.5); abline(lm.SM,col=SMcol); abline(lm.HP,col=HPcol); 
C.summ <- summarySE(data=growth[growth$Fed=='Y',],measurevar='muMC',groupvars=c('Light','Prey')); I.summ <- summarySE(data=growth[growth$Fed=='Y',],measurevar='preyCperMCperday',groupvars=c('Light','Prey')); arrows(I.summ[,4],C.summ[,4]+C.summ$se,I.summ[,4],C.summ[,4]-C.summ$se,code=3,angle=90,length=0.05,col='black'); arrows(I.summ[,4]+I.summ$se,C.summ[,4],I.summ[,4]-I.summ$se,C.summ[,4],code=3,angle=90,length=0.05); points(I.summ[,4],C.summ[,4],pch=c(21,22,24)[as.factor(C.summ$Light)],bg=preycolvec[C.summ$Prey],cex=1.5)

legend(1.5,0.29,legend=c('10uE','50uE','100uE'),pch=c(21,22,24),pt.cex=ptcex,pt.bg='black',col='black',bty='n',cex=1.2); legend(1,0.29,legend=c('CM','HP','RS','SM'),pch=21,pt.cex=ptcex,pt.bg=preycolvec,bty='n',cex=1.2); arrows(c(1,1,2.15,2.15),c(0.28,.08,.08,0.28),c(1,2.15,2.15,1),c(.08,.08,.28,.28),length=0)



# linear scale: prey per initial MC
par(mar=c(2,4,0.5,0.5))
bargraph.CI(Prey,(PreyperMC),group=Light,data=growth[growth$Fed=='Y',],legend=FALSE,err.width=0.05,names=c('CM','HP','RS','SM'),axes=TRUE,ylim=c(0,(380)),col=prey.light.colvec,space=c(0,0.5),las=1,ylab='Heterotrophy (ingested prey per initial cell)'); abline(h=0,lwd=1.5); legend(11.5,350,c('10 uE','50 uE','100 uE'),bty='y',pch=22,pt.cex=2,horiz=FALSE,pt.bg=c('gray30','gray65','gray90'),cex=1.2); text(x=xcoords,y=(c(50,160,370,50,55,50,50,60,53,50,72,65)-15),c('a','b','c',rep('a',9)),srt=0)


# FOURTH PLOT: total ingestion vs growth extent

par(mar=c(4,4,1,0.5))
growth.y <- growth[growth$Fed=='Y',]
lm.all <- lm(growth.y$relincrease~log(growth.y$heterotrophy.C)); summary(lm.all) #signif.; F-stat = 8.4, p-val = 0.006525, R2 = 0.1745, y = 1.4408 * x + .6685
lm.RS.f <- lm(relincrease~log(heterotrophy.C),data=growth.y[growth.y$Prey=='RS'&growth.y$Fed=='Y',]); summary(lm.RS.f) #non-signif
lm.SM.f <- lm(relincrease~log(heterotrophy.C),data=growth.y[growth.y$Prey=='SM'&growth.y$Fed=='Y',]); summary(lm.SM.f) #non-signif.
lm.CM.f <- lm(relincrease~log(heterotrophy.C),data=growth.y[growth.y$Prey=='CM'&growth.y$Fed=='Y',]); summary(lm.CM.f) #signif.; F-stat = 43.25, p-val = 0.0003111, R2 = 0.8408, y = 2.3409 * x + 3.2257
lm.HP.f <- lm(relincrease~log(heterotrophy.C),data=growth.y[growth.y$Prey=='HP'&growth.y$Fed=='Y',]); summary(lm.HP.f) #non-signif.

plot(log(as.numeric(as.character(growth.y$heterotrophy.C))),growth.y$relincrease,pch=c(21,22,24)[as.factor(growth.y$Light)],bg=c(CMcol,HPcol,RScol,SMcol)[growth.y$Prey],ylab='Growth Extent (fold increase)', xlab='Heterotrophy (ln(cum. prey C per initial MC C))',type='n',las=1,ylim=c(0,12)); growth.y$logprey <- log(growth.y$heterotrophy.C); C.summ <- summarySE(data=growth.y, measurevar='logprey',groupvars=c('Fed','Light','Prey')); I.summ <- summarySE(data=growth.y,measurevar='relincrease',groupvars=c('Fed','Light','Prey')) ;abline(lm.all,lwd=1.5); abline(lm.CM.f,col=CMcol) ; arrows(C.summ[,5],I.summ[,5]+I.summ$se,C.summ[,5],I.summ[,5]-I.summ$se,code=3,col=c('gray80','black')[C.summ$Fed],angle=90,length=0.05); arrows(C.summ[,5]+C.summ$se,I.summ[,5],C.summ[,5]-C.summ$se,I.summ[,5],code=3,col=c('gray80','black')[C.summ$Fed],angle=90,length=0.05); points(C.summ[,5],I.summ[,5],pch=c(21,22,24)[as.factor(C.summ$Light)],bg=preycolvec[C.summ$Prey],col=c('gray80','black')[C.summ$Fed],cex=1.5);



#legend(1050,12.2,legend=c('CM','HP','RS','SM'),pch=21,pt.cex=ptcex,pt.bg=preycolvec,bty='n'); arrows(c(50,50,1800,1800),c(12,7.8,7.8,12),c(50,1800,1800,50),c(7.8,7.8,12,12),length=0); 




```



### Figure 5, revision 2: Heterotrophic contributions to growth, linear heterotrophy
```{r, IngestionFigure.r2, fig.height=5,fig.width=7}

#layout(matrix(c(1,1,1,2,2,2,8,3,3,3,4,4,4,7,5,5,5,6,6,6,9),nrow=(6*3+3),ncol=1))
layout(matrix(c(1,1,1,2,2,3,3,3,4,4),nrow=2,ncol=5,byrow=TRUE))
xcoords <- c(1,2,3,4.5,5.5,6.5,8,9,10,11.5,12.5,13.5)



# ingestion rate
par(mar=c(2,4,0.5,0.5))
bargraph.CI(Prey,ingest_2,group=Light,data=growth[growth$Fed=='Y',],legend=FALSE,x.leg=1,y.leg=15,ylim=c(0,18),err.width=0.05,las=1,xlab='Prey Type',names=rep('',4),ylab='Ingestion Rate (prey per MC per day)',col=prey.light.colvec,space=c(0,0.5));  abline(h=0,lwd=1.5); text(x=xcoords,y=c(5.5,4,11,4.2,6.1,8.5,9,12.5,7.5,7,16.5,12.5),c('ab','a','cd','a','ab','bc','bc','de','ac','ac','e','de'),srt=0)

par(mar=c(4,4,1,0.5))

# SECOND PLOT: ingestion rate vs growth rate
# Revision: convert to per carbon
carbon$Prey.Rep <- paste(carbon$Prey,carbon$Rep,sep='.')
carbon$Sp.Rep <- paste(carbon$Species,carbon$Rep,sep='.')
growth$Prey.Rep <- paste(growth$Prey,growth$Rep,sep='.')
growth$MC.C <- carbon[carbon$Species=='MC',]$ngC_cell[match(growth$Prey.Rep,carbon[carbon$Species=='MC',]$Prey.Rep)]
growth$prey.C <- carbon[carbon$Species!='MC',]$ngC_cell[match(growth$Prey.Rep,carbon[carbon$Species!='MC',]$Sp.Rep)]

growth$preyCperMCperday <- growth$ingest_2*growth$prey.C/growth$MC.C
growth$heterotrophy.C <- growth$PreyperMC*growth$prey.C/growth$MC.C

lm.all <- lm(growth[growth$Fed=='Y',]$muMC~growth[growth$Fed=='Y',]$preyCperMCperday); summary(lm.all) #signif.; F-stat = 7.454, p-val = 0.009955, R2 = 0.1557, y = 0.11187 * x + 0.32865
lm.RS <- lm(muMC~preyCperMCperday,data=growth[growth$Prey=='RS'&growth$Fed=='Y',]); summary(lm.RS) #n.s.
lm.SM <- lm(muMC~preyCperMCperday,data=growth[growth$Prey=='SM'&growth$Fed=='Y',]); summary(lm.SM) #signif.; F-stat = 8.786, p-val = 0.02098, R2 = 0.4932, y = 0.16037 * x + 0.21793
lm.CM <- lm(muMC~preyCperMCperday,data=growth[growth$Prey=='CM'&growth$Fed=='Y',]); summary(lm.CM) #n.s.
lm.HP <- lm(muMC~preyCperMCperday,data=growth[growth$Prey=='HP'&growth$Fed=='Y',]); summary(lm.HP) #signif.; F-stat = 27.53, p-val = 0.00119, R2 = 0.7683, y = 0.88395 * x + 0.12936

plot(growth[growth$Fed=='Y',]$preyCperMCperday,growth[growth$Fed=='Y',]$muMC,las=1,pch=c(21,22,24)[as.factor(growth$Light)],bg=c(CMcol,HPcol,RScol,SMcol)[growth[growth$Fed=='Y',]$Prey],ylab='Growth Rate (per day)', xlab='Ingestion Rate (prey C per MC C per day)',type='n'); abline(lm.all,lwd=1.5); abline(lm.SM,col=SMcol); abline(lm.HP,col=HPcol); 
C.summ <- summarySE(data=growth[growth$Fed=='Y',],measurevar='muMC',groupvars=c('Light','Prey')); I.summ <- summarySE(data=growth[growth$Fed=='Y',],measurevar='preyCperMCperday',groupvars=c('Light','Prey')); arrows(I.summ[,4],C.summ[,4]+C.summ$se,I.summ[,4],C.summ[,4]-C.summ$se,code=3,angle=90,length=0.05,col='black'); arrows(I.summ[,4]+I.summ$se,C.summ[,4],I.summ[,4]-I.summ$se,C.summ[,4],code=3,angle=90,length=0.05); points(I.summ[,4],C.summ[,4],pch=c(21,22,24)[as.factor(C.summ$Light)],bg=preycolvec[C.summ$Prey],cex=1.5)

legend(1.5,0.29,legend=c('10uE','50uE','100uE'),pch=c(21,22,24),pt.cex=ptcex,pt.bg='black',col='black',bty='n',cex=1.2); legend(1,0.29,legend=c('CM','HP','RS','SM'),pch=21,pt.cex=ptcex,pt.bg=preycolvec,bty='n',cex=1.2); arrows(c(1,1,2.15,2.15),c(0.28,.08,.08,0.28),c(1,2.15,2.15,1),c(.08,.08,.28,.28),length=0)



# linear scale: prey per initial MC
par(mar=c(2,4,0.5,0.5))
bargraph.CI(Prey,(PreyperMC),group=Light,data=growth[growth$Fed=='Y',],legend=FALSE,err.width=0.05,names=c('CM','HP','RS','SM'),axes=TRUE,ylim=c(0,(380)),col=prey.light.colvec,space=c(0,0.5),las=1,ylab='Heterotrophy (ingested prey per initial cell)'); abline(h=0,lwd=1.5); legend(11.5,350,c('10 uE','50 uE','100 uE'),bty='y',pch=22,pt.cex=2,horiz=FALSE,pt.bg=c('gray30','gray65','gray90'),cex=1.2); text(x=xcoords,y=(c(50,160,370,50,55,50,50,60,53,50,72,65)-15),c('a','b','c',rep('a',9)),srt=0)


# FOURTH PLOT: total ingestion vs growth extent

par(mar=c(4,4,1,0.5))
growth.y <- growth[growth$Fed=='Y',]
lm.all <- lm(growth.y$relincrease~(growth.y$heterotrophy.C)); summary(lm.all) #signif.; F-stat = 9.359, p-val = 0.004308, R2 = 0.1928, y = 0.4003 * x + 4.4469
lm.RS.f <- lm(relincrease~(heterotrophy.C),data=growth.y[growth.y$Prey=='RS'&growth.y$Fed=='Y',]); summary(lm.RS.f) #non-signif
lm.SM.f <- lm(relincrease~(heterotrophy.C),data=growth.y[growth.y$Prey=='SM'&growth.y$Fed=='Y',]); summary(lm.SM.f) #non-signif.
lm.CM.f <- lm(relincrease~(heterotrophy.C),data=growth.y[growth.y$Prey=='CM'&growth.y$Fed=='Y',]); summary(lm.CM.f) #signif.; F-stat = 9.52, p-val = 0.01768, R2 = 0.5157, y = 0.4059 * x + 3.8178
lm.HP.f <- lm(relincrease~(heterotrophy.C),data=growth.y[growth.y$Prey=='HP'&growth.y$Fed=='Y',]); summary(lm.HP.f) #non-signif.

plot((as.numeric(as.character(growth.y$heterotrophy.C))),growth.y$relincrease,pch=c(21,22,24)[as.factor(growth.y$Light)],bg=c(CMcol,HPcol,RScol,SMcol)[growth.y$Prey],ylab='Growth Extent (fold increase)', xlab='Heterotrophy (ln(cum. prey C per initial MC C))',type='n',las=1,ylim=c(0,12)); growth.y$logprey <- (growth.y$heterotrophy.C); C.summ <- summarySE(data=growth.y, measurevar='logprey',groupvars=c('Fed','Light','Prey')); I.summ <- summarySE(data=growth.y,measurevar='relincrease',groupvars=c('Fed','Light','Prey')); abline(a=0,b=1,lty=2) ;abline(lm.all,lwd=1.5); abline(lm.CM.f,col=CMcol) ; arrows(C.summ[,5],I.summ[,5]+I.summ$se,C.summ[,5],I.summ[,5]-I.summ$se,code=3,col=c('gray80','black')[C.summ$Fed],angle=90,length=0.05); arrows(C.summ[,5]+C.summ$se,I.summ[,5],C.summ[,5]-C.summ$se,I.summ[,5],code=3,col=c('gray80','black')[C.summ$Fed],angle=90,length=0.05); points(C.summ[,5],I.summ[,5],pch=c(21,22,24)[as.factor(C.summ$Light)],bg=preycolvec[C.summ$Prey],col=c('gray80','black')[C.summ$Fed],cex=1.5)



#legend(1050,12.2,legend=c('CM','HP','RS','SM'),pch=21,pt.cex=ptcex,pt.bg=preycolvec,bty='n'); arrows(c(50,50,1800,1800),c(12,7.8,7.8,12),c(50,1800,1800,50),c(7.8,7.8,12,12),length=0); 




```


### Figure 6: Photosynthetic contributions to growth
```{r, PhotosynthateFigure_v2, fig.width=11,fig.height=4}

layout(matrix(c(8,1,2,3,4,rep(7,3),9,5,5,5,5,rep(7,3),10,6,6,6,6,rep(7,3)),nrow=3,ncol=8,byrow=TRUE)); #layout.show(10)


growth$C.fixed3 <- growth$C.fixed2/1000 # convert from pg to ng
growth$C.per.prey <- growth$C.fixed2/growth$TotPreyCons


xcoords <- c(1.2,3.4,5.6)
xcoords2 <- c(.7,1.7,2.9,3.9,5.1,6.1)
#quartz(height=3.5,width=7.5)
par(mar=c(1,1,0.5,0.5))
#layout(matrix(c(7,1,1,1,2,2,2,3,3,3,4,4,4,rep(6,6),8,rep(5,3*4),rep(6,6)),nrow=2,ncol=19,byrow=TRUE))

# Row 1: Photosynthate
ymax <- 50; ymin <- 0; bargraph.CI(Light,C.fixed3,group=Fed,data=growth[growth$Prey=='CM',],las=1,legend=FALSE,ylim=c(ymin,ymax),names=c('','',''),ylab='',space=c(0,.2),err.width=0.05); abline(h=0); mtext(substitute(paste(italic('C. mesostigmatica'))),side=3,line=-0.5,cex=.7);  mtext('ng C per init MC',side=2,line=2.5,cex=.7);text(x=xcoords2,y=c(2,4,5,42,4,44)+1,c('a','a','a','b','a','b'))


bargraph.CI(Light,C.fixed3,group=Fed,data=growth[growth$Prey=='HP',],las=1,legend=FALSE,leg.lab=c('Starved','Fed'),x.leg=1,y.leg=0.6,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05,ylab='',axes=FALSE); abline(h=0); mtext(substitute(paste(italic('H. pacifica'))),side=3,line=-0.5,cex=.7);  axis(side=2,labels=FALSE);text(x=xcoords2,y=c(4,6,5,6,6,10.5)+1,c('a','b','ab','b','b','c'))

bargraph.CI(Light,C.fixed3,group=Fed,data=growth[growth$Prey=='RS',],las=1,legend=FALSE,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05,ylab='',axes=FALSE); abline(h=0); mtext(substitute(paste(italic('R. salina'))),side=3,line=-0.4,cex=.7);  axis(side=2,labels=FALSE);text(x=xcoords2,y=c(4,12,9,35,28,45)+1,c('a','ab','ab','c','bc','c'))

bargraph.CI(Light,C.fixed3,group=Fed,data=growth[growth$Prey=='SM',],las=1,legend=TRUE,leg.lab=c('Starved','Fed'),x.leg=0,y.leg=ymax*.95,cex.leg=1.2,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05,ylab='',axes=FALSE); abline(h=0); mtext(substitute(paste(italic('S. major'))),side=3,line=-0.5,cex=.7);  axis(side=2,labels=FALSE);text(x=xcoords2,y=c(4,10,9,25,14,29)+1,c('a','ab','ab','c','b','c'))



# Second row: fold difference
xcoords <- c(1,2,3,4.5,5.5,6.5,8,9,10,11.5,12.5,13.5)

bargraph.CI(Prey,C.fixed2/abs(deltaCfixed-C.fixed2),group=Light,data=growth[growth$Fed=='Y',],legend=FALSE,err.width=0.05,las=3,names=rep('',4),col=prey.light.colvec,space=c(0,0.5),ylab='Fold inc C fix',ylim=c(0,21),las=1); abline(h=0,lwd=1.5); text(x=xcoords,y=c(5,18,20,3.5,2.8,3.3,5.8,6,3.2,5.7,5.7,4.2),c('a','b','b',rep('a',9)),srt=0); mtext('Fold Increase in Phototrophy',side=2,line=2.5,cex=.7); legend(12.5,18,c('10 uE','50 uE','100 uE'),bty='n',pch=22,pt.cex=2,horiz=FALSE,pt.bg=c('gray30','gray65','gray90'),cex=1.2); text(x=xcoords,y=(c(50,160,370,50,55,50,50,60,53,50,72,65)-15),c('a','b','c',rep('a',9)),srt=0)

#TukeyHSD(aov(C.fixed2/abs(deltaCfixed-C.fixed2)~as.factor(Light)*Prey,data=growth[growth$Fed=='Y',]))

# Third row: Carbon fixed per prey ingested
bargraph.CI(Prey,C.per.prey,group=Light,data=growth[growth$Fed=='Y',],legend=FALSE,err.width=0.05,las=3,names=rep('',4),col=prey.light.colvec,space=c(0,0.5),ylab='',ylim=c(0,3),las=1); abline(h=0,lwd=1.5); text(x=xcoords,y=c(.3,.8,.7,.5,.4,.9,1,2,2.8,.7,1.2,1.3),c('a','ab','ab','ab','ac','abd','abd','de','f','ab','be','bce'),srt=0); mtext('pg C per prey',side=2,line=2.5,cex=.7);

#TukeyHSD(aov(C.per.prey~as.factor(Light)*Prey,data=growth[growth$Fed=='Y',]))

# FOURTH PLOT: total photosynthate vs growth extent
par(mar=c(4,5,.5,0.5))

lm.all <- lm(growth$relincrease~growth$C.fixed3); summary(lm.all) #signif.; F-stat = 363.6, p-val = < 2.2 e-16, R2 = 0.8382, y = 0.0023981 * x + 1.4461272
lm.RS.f <- lm(relincrease~C.fixed3,data=growth[growth$Prey=='RS'&growth$Fed=='Y',]); summary(lm.RS.f) #signif.; F-stat = 61.06, p-val = 0.0001059, R2 = 0.8825, y = 0.0024954 * x + 2.5941469
lm.RS.n <- lm(relincrease~C.fixed3,data=growth[growth$Prey=='RS'&growth$Fed=='N',]); summary(lm.RS.n) #signif.; F-stat = 92.92, p-val = 2.724e-05, R2 = 0.9199, y = 0.0020467 * x + 1.1968818
lm.SM.f <- lm(relincrease~C.fixed3,data=growth[growth$Prey=='SM'&growth$Fed=='Y',]); summary(lm.SM.f) #non-signif.
lm.SM.n <- lm(relincrease~C.fixed3,data=growth[growth$Prey=='SM'&growth$Fed=='N',]); summary(lm.SM.n) #non-signif.
lm.CM.f <- lm(relincrease~C.fixed3,data=growth[growth$Prey=='CM'&growth$Fed=='Y',]); summary(lm.CM.f) #signif.; F-stat = 393.3, p-val = 2.072e-07, R2 = 0.98, y = 1.875e-3 * x + 2.246
lm.CM.n <- lm(relincrease~C.fixed3,data=growth[growth$Prey=='CM'&growth$Fed=='N',]); summary(lm.CM.n) #non-signif.
lm.HP.f <- lm(relincrease~C.fixed3,data=growth[growth$Prey=='HP'&growth$Fed=='Y',]); summary(lm.HP.f) #signif.; F-stat = 10.91, p-val = 0.01307, R2 = 0.5533, y = 0.0031937 * x + 1.6569938
lm.HP.n <- lm(relincrease~C.fixed3,data=growth[growth$Prey=='HP'&growth$Fed=='N',]); summary(lm.HP.n) #non-signif.

plot(growth$C.fixed2/1000,growth$relincrease,pch=c(21,22)[growth$Fed],bg=preycolvec[growth$Prey],las=1,ylab='Growth Extent (fold increase)',xlab='Phototrophy (ng C per initial cell)',type='n',ylim=c(0,12)); abline(lm.all,lwd=1.5); abline(lm.RS.f,col=RScol); abline(lm.RS.n,col=RScol,lty=2); abline(lm.CM.f,col=CMcol); abline(lm.HP.f,col=HPcol); C.summ <- summarySE(data=growth,measurevar='C.fixed2',groupvars=c('Fed','Light','Prey')); I.summ <- summarySE(data=growth,measurevar='relincrease',groupvars=c('Fed','Light','Prey')); arrows(C.summ[,5]/1000,I.summ[,5]+I.summ$se,C.summ[,5]/1000,I.summ[,5]-I.summ$se,code=3,col=c('gray80','black')[C.summ$Fed],angle=90,length=0.05); arrows(C.summ[,5]/1000+C.summ$se/1000,I.summ[,5],C.summ[,5]/1000-C.summ$se/1000,I.summ[,5],code=3,col=c('gray80','black')[C.summ$Fed],angle=90,length=0.05); points(C.summ[,5]/1000,I.summ[,5],pch=c(21,22,24)[as.factor(C.summ$Light)],bg=preycolvec[C.summ$Prey],col=c('gray80','black')[C.summ$Fed],cex=1.5); legend(0,12.2,legend=c('10uE','50uE','100uE','Starved','Fed'),pch=c(21,22,24,21,21),pt.cex=1.5,pt.bg=c(rep('black',3),'gray80','black'),col=c(rep('black',3),'gray80','black'),bty='n'); legend(1040*12/1000,12.2,legend=c('CM','HP','RS','SM'),pch=21,pt.cex=1.5,pt.bg=preycolvec,bty='n'); arrows(c(50,50,1800*12,1800*12)/1000,c(12,8.4,8.4,12),c(50,1800*12,1800*12,50)/1000,c(8.4,8.4,12,12),length=0)


TukeyHSD(aov(C.fixed3~Fed*as.factor(Light),data=growth[growth$Prey=='SM',]))
```

### Figure 6, Revision: Photosynthetic contributions to growth
```{r, PhotosynthateFigure_r1, fig.width=11,fig.height=4}

layout(matrix(c(8,1,2,3,4,rep(7,3),9,5,5,5,5,rep(7,3),10,6,6,6,6,rep(7,3)),nrow=3,ncol=8,byrow=TRUE)); #layout.show(10)


growth$C.fixed3 <- growth$C.fixed2/1000 # convert from pg to ng
growth$C.per.prey <- growth$C.fixed2/growth$TotPreyCons
growth$C.fixed.perMC.C <- growth$C.fixed3/growth$MC.C # convert from per MC cell to per MC ng C


xcoords <- c(1.2,3.4,5.6)
xcoords2 <- c(.7,1.7,2.9,3.9,5.1,6.1)
#quartz(height=3.5,width=7.5)
par(mar=c(1,1,0.5,0.5))
#layout(matrix(c(7,1,1,1,2,2,2,3,3,3,4,4,4,rep(6,6),8,rep(5,3*4),rep(6,6)),nrow=2,ncol=19,byrow=TRUE))

# Row 1: Photosynthate
ymax <- 50; ymin <- 0; bargraph.CI(Light,C.fixed3,group=Fed,data=growth[growth$Prey=='CM',],las=1,legend=FALSE,ylim=c(ymin,ymax),names=c('','',''),ylab='',space=c(0,.2),err.width=0.05); abline(h=0); mtext(substitute(paste(italic('C. mesostigmatica'))),side=3,line=-0.5,cex=.7);  mtext('ng C per init MC',side=2,line=2.5,cex=.7);text(x=xcoords2,y=c(2,4,5,42,4,44)+1,c('a','a','a','b','a','b'))


bargraph.CI(Light,C.fixed3,group=Fed,data=growth[growth$Prey=='HP',],las=1,legend=FALSE,leg.lab=c('Starved','Fed'),x.leg=1,y.leg=0.6,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05,ylab='',axes=FALSE); abline(h=0); mtext(substitute(paste(italic('H. pacifica'))),side=3,line=-0.5,cex=.7);  axis(side=2,labels=FALSE);text(x=xcoords2,y=c(4,6,5,6,6,10.5)+1,c('a','b','ab','b','b','c'))

bargraph.CI(Light,C.fixed3,group=Fed,data=growth[growth$Prey=='RS',],las=1,legend=FALSE,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05,ylab='',axes=FALSE); abline(h=0); mtext(substitute(paste(italic('R. salina'))),side=3,line=-0.4,cex=.7);  axis(side=2,labels=FALSE);text(x=xcoords2,y=c(4,12,9,35,28,45)+1,c('a','ab','ab','c','bc','c'))

bargraph.CI(Light,C.fixed3,group=Fed,data=growth[growth$Prey=='SM',],las=1,legend=TRUE,leg.lab=c('Starved','Fed'),x.leg=0,y.leg=ymax*.95,cex.leg=1.2,ylim=c(ymin,ymax),names=c('','',''),space=c(0,.2),err.width=0.05,ylab='',axes=FALSE); abline(h=0); mtext(substitute(paste(italic('S. major'))),side=3,line=-0.5,cex=.7);  axis(side=2,labels=FALSE);text(x=xcoords2,y=c(4,10,9,25,14,29)+1,c('a','ab','ab','c','b','c'))



# Second row: fold difference
xcoords <- c(1,2,3,4.5,5.5,6.5,8,9,10,11.5,12.5,13.5)

bargraph.CI(Prey,C.fixed2/abs(deltaCfixed-C.fixed2),group=Light,data=growth[growth$Fed=='Y',],legend=FALSE,err.width=0.05,las=3,names=rep('',4),col=prey.light.colvec,space=c(0,0.5),ylab='Fold inc C fix',ylim=c(0,21),las=1); abline(h=0,lwd=1.5); text(x=xcoords,y=c(5,18,20,3.5,2.8,3.3,5.8,6,3.2,5.7,5.7,4.2),c('a','b','b',rep('a',9)),srt=0); mtext('Fold Increase in Phototrophy',side=2,line=2.5,cex=.7); legend(12.5,18,c('10 uE','50 uE','100 uE'),bty='n',pch=22,pt.cex=2,horiz=FALSE,pt.bg=c('gray30','gray65','gray90'),cex=1.2); text(x=xcoords,y=(c(50,160,370,50,55,50,50,60,53,50,72,65)-15),c('a','b','c',rep('a',9)),srt=0)

#TukeyHSD(aov(C.fixed2/abs(deltaCfixed-C.fixed2)~as.factor(Light)*Prey,data=growth[growth$Fed=='Y',]))

# Third row: Carbon fixed per prey ingested
bargraph.CI(Prey,C.per.prey,group=Light,data=growth[growth$Fed=='Y',],legend=FALSE,err.width=0.05,las=3,names=rep('',4),col=prey.light.colvec,space=c(0,0.5),ylab='',ylim=c(0,3),las=1); abline(h=0,lwd=1.5); text(x=xcoords,y=c(.3,.8,.7,.5,.4,.9,1,2,2.8,.7,1.2,1.3),c('a','ab','ab','ab','ac','abd','abd','de','f','ab','be','bce'),srt=0); mtext('pg C per prey',side=2,line=2.5,cex=.7);

#TukeyHSD(aov(C.per.prey~as.factor(Light)*Prey,data=growth[growth$Fed=='Y',]))

# FOURTH PLOT: total photosynthate vs growth extent
par(mar=c(4,5,.5,0.5))

lm.all <- lm(growth$relincrease~growth$C.fixed.perMC.C); summary(lm.all) #signif.; F-stat = 310.2, p-val = < 2.2 e-16, R2 = 0.8132, y = 0.144306 * x + 1.471040
lm.RS.f <- lm(relincrease~C.fixed.perMC.C,data=growth[growth$Prey=='RS'&growth$Fed=='Y',]); summary(lm.RS.f) #signif.; F-stat = 35.36, p-val = 0.0005724, R2 = 0.8111, y = 0.11449 * x + 3.29289
lm.RS.n <- lm(relincrease~C.fixed.perMC.C,data=growth[growth$Prey=='RS'&growth$Fed=='N',]); summary(lm.RS.n) #signif.; F-stat = 26.89, p-val = 0.001273, R2 = 0.7639, y = 0.10831 * x + 1.27520
lm.SM.f <- lm(relincrease~C.fixed.perMC.C,data=growth[growth$Prey=='SM'&growth$Fed=='Y',]); summary(lm.SM.f) #non-signif.
lm.SM.n <- lm(relincrease~C.fixed.perMC.C,data=growth[growth$Prey=='SM'&growth$Fed=='N',]); summary(lm.SM.n) #non-signif.
lm.CM.f <- lm(relincrease~C.fixed.perMC.C,data=growth[growth$Prey=='CM'&growth$Fed=='Y',]); summary(lm.CM.f) #signif.; F-stat = 252.1, p-val =  9.538e-07, R2 = 0.9691, y = 0.151643 * x + 2.329967
lm.CM.n <- lm(relincrease~C.fixed.perMC.C,data=growth[growth$Prey=='CM'&growth$Fed=='N',]); summary(lm.CM.n) #non-signif.
lm.HP.f <- lm(relincrease~C.fixed.perMC.C,data=growth[growth$Prey=='HP'&growth$Fed=='Y',]); summary(lm.HP.f) #signif.; F-stat = 5.713, p-val = 0.04816, R2 = 0.3707, y = 0.11838 * x + 2.00481
lm.HP.n <- lm(relincrease~C.fixed.perMC.C,data=growth[growth$Prey=='HP'&growth$Fed=='N',]); summary(lm.HP.n) #non-signif.

plot(growth$C.fixed.perMC.C,growth$relincrease,pch=c(21,22)[growth$Fed],bg=preycolvec[growth$Prey],las=1,ylab='Growth Extent (fold increase)',xlab='Phototrophy (ng C per initial ng C)',type='n',ylim=c(0,12));abline(a  = 0, b =1, lty=2); abline(lm.all,lwd=1.5); abline(lm.RS.f,col=RScol); abline(lm.RS.n,col=RScol,lty=2); abline(lm.CM.f,col=CMcol); abline(lm.HP.f,col=HPcol); C.summ <- summarySE(data=growth,measurevar='C.fixed.perMC.C',groupvars=c('Fed','Light','Prey')); I.summ <- summarySE(data=growth,measurevar='relincrease',groupvars=c('Fed','Light','Prey')); arrows(C.summ[,5],I.summ[,5]+I.summ$se,C.summ[,5],I.summ[,5]-I.summ$se,code=3,col=c('gray80','black')[C.summ$Fed],angle=90,length=0.05); arrows(C.summ[,5]+C.summ$se,I.summ[,5],C.summ[,5]-C.summ$se,I.summ[,5],code=3,col=c('gray80','black')[C.summ$Fed],angle=90,length=0.05); points(C.summ[,5],I.summ[,5],pch=c(21,22,24)[as.factor(C.summ$Light)],bg=preycolvec[C.summ$Prey],col=c('gray80','black')[C.summ$Fed],cex=1.5); legend(45,3,legend=c('10uE','50uE','100uE','Starved','Fed'),pch=c(21,22,24,21,21),pt.cex=1.5,pt.bg=c(rep('black',3),'gray80','black'),col=c(rep('black',3),'gray80','black'),bty='n'); legend(65,3,legend=c('CM','HP','RS','SM'),pch=21,pt.cex=1.5,pt.bg=preycolvec,bty='n'); arrows(c(45,45,78,78),c(3,0,0,3),c(45,78,78,45),c(0,0,3,3),length=0)


TukeyHSD(aov(C.fixed3~Fed*as.factor(Light),data=growth[growth$Prey=='SM',]))
```




### Supplementary Figures, Revision: Timeseries of cells and pigments
```{r SuppFig.CellsChl, fig.height=7.5,fig.width=9.4, warning=FALSE,message=FALSE}

# Choose the data columns to use, their names, and their maxima
#datcols <- c(8,9,30,dim(dat)[2]-2,dim(dat)[2]-1)
datcols <- c(which(names(dat)=='MC_cellspmL'),which(names(dat)=='Prey_cellspmL'),which(names(dat)=='PlastidCount'),which(names(dat)=='chl_p_cell'),which(names(dat)=='ChlperC'),which(names(dat)=='chl_p_mL')) # data columns to use. CHECK THIS CAREFULLY 
ylabstrs <- c('MC (cells/mL)','Prey (cells/mL)','Plastids (per MC cell)','MC chl (pg/cell)','MC chl (pg/C)','Tot. chl (ng/mL)') # y-labels
ymax <- c(10000,25000,30,55,85,100)

# We will partition data by light level
lightvec <- c(10,50,100)
titlestr <- paste(as.character(lightvec),'uE'); titlestr <- rbind(titlestr,c(rep('',3)),c(rep('',3)),c(rep('',3)),c(rep('',3)),c(rep('',3)))

# Iterate over different prey types
preyvec <- c('CM','HP','RS','SM')
preycolvec <- c(CMcol,HPcol,RScol,SMcol)

# Step 1: choose your prey type & subset data

for(k in 1:length(preyvec)){

# Step 1: Choose the prey and subset data accordingly
preychoice <- preyvec[k]
dat.hold2 <- dat[dat$Prey==preychoice,]


par(mar=c(1,4,1,0.1),mfcol=c(length(datcols),length(lightvec)))
# Note that we've used the argument "mfcol" instead of "mfrow." This ensures that the subsequent mega-plot is filled in by column (i.e., starting from top left, and then going down left column, as opposed to starting from top left, and then going across top row), such that each column of the plot will contain data from one light level. The light levels will be ordered from left to right from lowest to highest light (that's what the 'sort' function used in the creation of "lightvec" does).

for(j in 1:length(lightvec)){
	
# Step 2: Subset the data again for appropriate light level
dat.hold <- dat.hold2[dat.hold2$Light==lightvec[j],]
# Step 3: Create summary stats. 
summ.MC<-summarySE(data=dat.hold,measurevar="MC_cellspmL",groupvars=c("ExptDay",'Fed'),na.rm=TRUE)
summ.prey<-summarySE(data=dat.hold,measurevar="Prey_cellspmL",groupvars=c("ExptDay",'Fed'),na.rm=TRUE)
summ.chl<-summarySE(data=dat.hold,measurevar="chl_p_cell",groupvars=c("ExptDay",'Fed'),na.rm=TRUE)
summ.chl.p.mL <- summarySE(data=dat.hold,measurevar='chl_p_mL',groupvars=c("ExptDay",'Fed'),na.rm=TRUE)
summ.chl.p.C <- summarySE(data=dat.hold,measurevar='ChlperC',groupvars=c("ExptDay",'Fed'),na.rm=TRUE)
summ.Plastids<-summarySE(data=dat.hold,measurevar="PlastidCount",groupvars=c("ExptDay",'Fed'),na.rm=TRUE)

# Step 4: Make all the plots
for(i in 1:length(datcols)){	

# Create axes using raw data
plot(dat.hold$ExptDay, dat.hold[,datcols[i]], type='n', las=1, xlab='', main=titlestr[i,j],ylim=c(0,ymax[i]),ylab=''); if(j==1){mtext(ylabstrs[i],side = 2, line = 3.2, cex=.7 )}

if(i == 1){ summ.use <- summ.MC }; if(i == 2){ summ.use <- summ.prey }; if(i == 4){ summ.use <- summ.chl }; if(i == 6){ summ.use <- summ.chl.p.mL }; if(i == 3){ summ.use <- summ.Plastids }; if(i==5){summ.use <- summ.chl.p.C}

# Plot lines connecting means
lines(summ.use[summ.use$Fed=='N',]$ExptDay,summ.use[summ.use$Fed=='N',][,4],col= Starvedcol); lines(summ.use[summ.use$Fed=='Y',]$ExptDay,summ.use[summ.use$Fed=='Y',][,4],col=Fedcol)

# Plot std error
summ.use.Y <- summ.use[summ.use$Fed=="Y",]; summ.use.N <- summ.use[summ.use$Fed=="N",]
arrows(summ.use.Y$ExptDay,summ.use.Y[,4]+summ.use.Y$se,summ.use.Y$ExptDay,summ.use.Y[,4]-summ.use.Y$se,col=Fedcol,code=3,angle=90,length=.05); arrows(summ.use.N$ExptDay,summ.use.N[,4]+summ.use.N$se,summ.use.N$ExptDay,summ.use.N[,4]-summ.use.N$se,col=Starvedcol,code=3,angle=90,length=.05)

# Plot means
points(summ.use$ExptDay,summ.use[,4],pch=22,col=c(Starvedcol,Fedcol)[summ.use$Fed],bg=c(Starvedcol,Fedcol)[summ.use$Fed])

}}
}

```

### Supplementary Figures: Photophysiology timeseries
```{r SuppFig.FIReTS, fig.height=6.5,fig.width=9.4, warning=FALSE}

# Choose the data columns to use, their names, and their maxima
datcols <- c(12,21,dim(dat)[2]-4,dim(dat)[2]-3) # data columns to use. CHECK THIS CAREFULLY 
ylabstrs <- c('Photosynth. Eff. (Fv/Fm)','ETR','PI_chl','PI_cell') # y-labels
ymax <- rbind(rep(0.6,3),c(20,80,150),c(2,5,10),c(30,100,150))
ymin <- c(0.1,0,0,0)

# We will partition data by light level
lightvec <- c(10,50,100)
titlestr <- paste(as.character(lightvec),'uE'); titlestr <- rbind(titlestr,c(rep('',4)),c(rep('',4)),c(rep('',4)))

# Iterate over different prey types
preyvec <- c('CM','HP','RS','SM')

# Step 1: choose your prey type & subset data

for(k in 1:length(preyvec)){

# Step 1: Choose the prey and subset data accordingly
preychoice <- preyvec[k]
dat.hold2 <- dat[dat$Prey==preychoice,]
crypto.hold2 <- crypto.dat[crypto.dat$Prey==preychoice,]


par(mar=c(2,4,2,1),mfcol=c(length(datcols),length(lightvec)))
# Note that we've used the argument "mfcol" instead of "mfrow." This ensures that the subsequent mega-plot is filled in by column (i.e., starting from top left, and then going down left column, as opposed to starting from top left, and then going across top row), such that each column of the plot will contain data from one light level. The light levels will be ordered from left to right from lowest to highest light (that's what the 'sort' function used in the creation of "lightvec" does).

for(j in 1:length(lightvec)){
	
# Step 2: Subset the data again for appropriate light level
dat.hold <- dat.hold2[dat.hold2$Light==lightvec[j],]
crypto.hold <-crypto.hold2[crypto.hold2$Light==lightvec[j],]
# Step 3: Create summary stats. 
summ.FvFm<-summarySE(data=dat.hold,measurevar="FvFm",groupvars=c("ExptDay",'Fed'),na.rm=TRUE); crypto.FvFm <- summarySE(data=crypto.hold,measurevar='Fv.Fm',groupvars=c("ExptDay"),na.rm=TRUE)
summ.ETR <- summarySE(data=dat.hold,measurevar='ETR_I',groupvars=c("ExptDay",'Fed'),na.rm=TRUE); crypto.ETR <- summarySE(data=crypto.hold,measurevar='P_I',groupvars=c("ExptDay"),na.rm=TRUE)

summ.PIchl<-summarySE(data=dat.hold,measurevar="PI_chl",groupvars=c("ExptDay",'Fed'),na.rm=TRUE); crypto.PIchl <- summarySE(data=crypto.hold,measurevar='PI_chl',groupvars=c("ExptDay"),na.rm=TRUE)
summ.PIcell<-summarySE(data=dat.hold,measurevar="PI_cell",groupvars=c("ExptDay",'Fed'),na.rm=TRUE); crypto.PIcell <- summarySE(data=crypto.hold,measurevar='PI_cell',groupvars=c("ExptDay"),na.rm=TRUE)

# Step 4: Make all the plots
for(i in 1:length(datcols)){	

# Create axes using raw data
plot(dat.hold$ExptDay, dat.hold[,datcols[i]], type='n', las=1, ylab=ylabstrs[i], xlab='', main=titlestr[i,j],ylim=c(ymin[i],ymax[i,j]));

if(i == 1){ summ.use <- summ.FvFm; crypto.use<-crypto.FvFm }; if(i == 2){ summ.use <- summ.ETR; crypto.use <- crypto.ETR }; if(i == 3){ summ.use <- summ.PIchl; crypto.use <- crypto.PIchl }; if(i == 4){ summ.use <- summ.PIcell; crypto.use <- crypto.PIcell }

# Plot lines connecting means
lines(summ.use[summ.use$Fed=='N',]$ExptDay,summ.use[summ.use$Fed=='N',][,4],col= Starvedcol); lines(summ.use[summ.use$Fed=='Y',]$ExptDay,summ.use[summ.use$Fed=='Y',][,4],col=Fedcol); lines(crypto.use$ExptDay,crypto.use[,3],col=preycolvec[k],lty=2)

# Plot std error
summ.use.Y <- summ.use[summ.use$Fed=="Y",]; summ.use.N <- summ.use[summ.use$Fed=="N",]
arrows(summ.use.Y$ExptDay,summ.use.Y[,4]+summ.use.Y$se,summ.use.Y$ExptDay,summ.use.Y[,4]-summ.use.Y$se,col=Fedcol,code=3,angle=90,length=.05); arrows(summ.use.N$ExptDay,summ.use.N[,4]+summ.use.N$se,summ.use.N$ExptDay,summ.use.N[,4]-summ.use.N$se,col=Starvedcol,code=3,angle=90,length=.05); arrows(crypto.use$ExptDay,crypto.use[,3]+crypto.use$se,crypto.use$ExptDay,crypto.use[,3]-crypto.use$se,col=preycolvec[k],code=3,angle=90,length=0.05)

# Plot means
points(summ.use$ExptDay,summ.use[,4],pch=22,col=c(Starvedcol,Fedcol)[summ.use$Fed],bg=c(Starvedcol,Fedcol)[summ.use$Fed]); points(crypto.use$ExptDay,crypto.use[,3],pch=22,col=preycolvec[k],bg=preycolvec[k])

}}
}

```



### Supplementary Figures: Photophysiology timeseries, revision 1
```{r SuppFig.FIReTS.r1, fig.height=9.5,fig.width=9.4, warning=FALSE}

# Choose the data columns to use, their names, and their maxima
datcols <- c(which(names(dat)=='FvFm'),which(names(dat)=='a'),which(names(dat)=='Pmax'),which(names(dat)=='PI_chl'),which(names(dat)=='PI_C'),which(names(dat)=='PI_cell')) # data columns to use. CHECK THIS CAREFULLY 
ylabstrs <- c('Photosynth. Eff. (Fv/Fm)','alpha','Pmax','PI_chl','PI_C','PI_cell') # y-labels
ymax <- rbind(rep(0.6,3),c(2.3,3,3),c(150,200,250),c(2,5,10),c(100,400,500),c(35,100,160))
ymin <- c(0.1,0,0,0,0,0)

# We will partition data by light level
lightvec <- c(10,50,100)
titlestr <- paste(as.character(lightvec),'uE'); titlestr <- rbind(titlestr,c(rep('',3)),c(rep('',3)),c(rep('',3)),c(rep('',3)),c(rep('',3)))

# Iterate over different prey types
preyvec <- c('CM','HP','RS','SM')

# Step 1: choose your prey type & subset data

for(k in 1:length(preyvec)){

# Step 1: Choose the prey and subset data accordingly
preychoice <- preyvec[k]
dat.hold2 <- dat[dat$Prey==preychoice,]
crypto.hold2 <- crypto.dat[crypto.dat$Prey==preychoice,]


par(mar=c(1,4,1,.1),mfcol=c(length(datcols),length(lightvec)))
# Note that we've used the argument "mfcol" instead of "mfrow." This ensures that the subsequent mega-plot is filled in by column (i.e., starting from top left, and then going down left column, as opposed to starting from top left, and then going across top row), such that each column of the plot will contain data from one light level. The light levels will be ordered from left to right from lowest to highest light (that's what the 'sort' function used in the creation of "lightvec" does).

for(j in 1:length(lightvec)){
	
# Step 2: Subset the data again for appropriate light level
dat.hold <- dat.hold2[dat.hold2$Light==lightvec[j],]
crypto.hold <-crypto.hold2[crypto.hold2$Light==lightvec[j],]
# Step 3: Create summary stats. 
summ.FvFm<-summarySE(data=dat.hold,measurevar="FvFm",groupvars=c("ExptDay",'Fed'),na.rm=TRUE); crypto.FvFm <- summarySE(data=crypto.hold,measurevar='Fv.Fm',groupvars=c("ExptDay"),na.rm=TRUE)
summ.ETR <- summarySE(data=dat.hold,measurevar='PI_C',groupvars=c("ExptDay",'Fed'),na.rm=TRUE); crypto.ETR <- summarySE(data=crypto.hold,measurevar='PI_C',groupvars=c("ExptDay"),na.rm=TRUE)

summ.alpha <- summarySE(data=dat.hold,measurevar='a',groupvars=c("ExptDay",'Fed'),na.rm=TRUE); crypto.alpha <- summarySE(data=crypto.hold,measurevar='a',groupvars=c("ExptDay"),na.rm=TRUE); crypto.alpha$a <- abs(crypto.alpha$a)
summ.Pmax <- summarySE(data=dat.hold,measurevar='Pmax',groupvars=c("ExptDay",'Fed'),na.rm=TRUE);
if(preychoice=='CM'){if(j == 3){summ.Pmax[13,4]<-NaN}}
crypto.Pmax <- summarySE(data=crypto.hold,measurevar='Pmax',groupvars=c("ExptDay"),na.rm=TRUE); crypto.Pmax$Pmax<-abs(crypto.Pmax$Pmax)

summ.PIchl<-summarySE(data=dat.hold,measurevar="PI_chl",groupvars=c("ExptDay",'Fed'),na.rm=TRUE); crypto.PIchl <- summarySE(data=crypto.hold,measurevar='PI_chl',groupvars=c("ExptDay"),na.rm=TRUE)
summ.PIcell<-summarySE(data=dat.hold,measurevar="PI_cell",groupvars=c("ExptDay",'Fed'),na.rm=TRUE); crypto.PIcell <- summarySE(data=crypto.hold,measurevar='PI_cell',groupvars=c("ExptDay"),na.rm=TRUE)

# Step 4: Make all the plots
for(i in 1:length(datcols)){	

# Create axes using raw data
plot(dat.hold$ExptDay, dat.hold[,datcols[i]], type='n', las=1, xlab='', main=titlestr[i,j],ylim=c(ymin[i],ymax[i,j]),ylab=''); if(j==1){mtext(ylabstrs[i],side = 2, line = 2.5, cex=.7 )}

if(i == 1){ summ.use <- summ.FvFm; crypto.use<-crypto.FvFm }; if(i == 2){ summ.use <- summ.alpha; crypto.use<-crypto.alpha }; if(i == 3){ summ.use <- summ.Pmax; crypto.use<-crypto.Pmax }; if(i == 5){ summ.use <- summ.ETR; crypto.use <- crypto.ETR }; if(i == 4){ summ.use <- summ.PIchl; crypto.use <- crypto.PIchl }; if(i == 6){ summ.use <- summ.PIcell; crypto.use <- crypto.PIcell }

# Plot lines connecting means
lines(summ.use[summ.use$Fed=='N',]$ExptDay,summ.use[summ.use$Fed=='N',][,4],col= Starvedcol); lines(summ.use[summ.use$Fed=='Y',]$ExptDay,summ.use[summ.use$Fed=='Y',][,4],col=Fedcol); lines(crypto.use$ExptDay,crypto.use[,3],col=preycolvec[k],lty=2)

# Plot std error
summ.use.Y <- summ.use[summ.use$Fed=="Y",]; summ.use.N <- summ.use[summ.use$Fed=="N",]
arrows(summ.use.Y$ExptDay,summ.use.Y[,4]+summ.use.Y$se,summ.use.Y$ExptDay,summ.use.Y[,4]-summ.use.Y$se,col=Fedcol,code=3,angle=90,length=.05); arrows(summ.use.N$ExptDay,summ.use.N[,4]+summ.use.N$se,summ.use.N$ExptDay,summ.use.N[,4]-summ.use.N$se,col=Starvedcol,code=3,angle=90,length=.05); arrows(crypto.use$ExptDay,crypto.use[,3]+crypto.use$se,crypto.use$ExptDay,crypto.use[,3]-crypto.use$se,col=preycolvec[k],code=3,angle=90,length=0.05)

# Plot means
points(summ.use$ExptDay,summ.use[,4],pch=22,col=c(Starvedcol,Fedcol)[summ.use$Fed],bg=c(Starvedcol,Fedcol)[summ.use$Fed]); points(crypto.use$ExptDay,crypto.use[,3],pch=22,col=preycolvec[k],bg=preycolvec[k])

}}
}

```


